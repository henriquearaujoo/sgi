<!DOCTYPE html>
<ui:composition template="/WEB-INF/LayoutFullPage.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:jsf="http://xmlns.jcp.org/jsf">

	<ui:define name="content">
		<script type="text/javascript">
			function start() {
			    PF('statusDialog').show();
			}
			 
			function stop() {
			    PF('statusDialog').hide();
			}


			
			$(document).ready(function(){
			  $('[data-toggle="tooltip"]').tooltip();   
			});
			

			
		</script>

		<style type="text/css">
.semBorda tr, .semBorda td {
	border: none !important;
}
</style>


		<h:panelGroup id="panel-content">

			<h:panelGroup id="panel-listagem"
				rendered="#{viagemController.panelListagem}">



				<h:form id="form-listagem" styleClass="default-style-form-filter">
					<br />
					<p:breadCrumb class="breadcrumb-container">


						<p:menuitem value="Categories" url="home_new.xhtml" />
						<p:menuitem value="Solicitação de viagem"
							url="SolicitacaoViagem.xhtml" />
					</p:breadCrumb>

					<p:panel id="filter-list">

						<p:messages id="msg-pagamento" showSummary="false"
							style="margin-top:10px" showDetail="true" closable="true"
							showIcon="true" />





						<div class="ui-g ui-fluid">

							<div class="ui-g-12 ui-md-6 ui-lg-3 form-group ">
								<h:outputText value="Código:" />
								<p:inputText value="#{viagemController.filtro.codigo}" />
							</div>

							<div class="ui-g-12 ui-md-6 ui-lg-3 form-group ">
								<h:outputText value="Solicitante:" />
								<p:inputText value="#{viagemController.filtro.nome}"
									style="width:230px" />
							</div>

							<div class="ui-g-12 ui-md-6 ui-lg-3 form-group ">
								<h:outputText value="Dt. ínicio:" />
								<p:calendar id="dt_inicio" styleClass="font12-vi" size="10"
									value="#{viagemController.filtro.dataInicio}"
									timeZone="America/Manaus" navigator="true" pattern="dd/MM/yyyy" />
							</div>

							<div class="ui-g-12 ui-md-6 ui-lg-3 form-group ">
								<h:outputText value="Dt. final:" />
								<p:calendar id="dt_final" styleClass="font12-vi" size="10"
									value="#{viagemController.filtro.dataFinal}"
									timeZone="America/Manaus" navigator="true" pattern="dd/MM/yyyy" />
							</div>
						</div>

						<div class="ui-g ui-fluid">

							<div class="ui-g-12 ui-md-6 ui-lg-3 form-group ">
								<h:outputText value="Gestão:" />
								<p:autoComplete styleClass="font12-vi" panelStyle="width:180px"
									size="50" placeholder="Superintendencia/Coordenadoria/Regional"
									value="#{viagemController.filtro.gestao}"
									completeMethod="#{viagemController.completeGestao}"
									var="gestao" itemLabel="#{gestao.nome}" itemValue="#{gestao}"
									converter="gestaoConverterVI" minQueryLength="3" />
							</div>


							<div class="ui-g-12 ui-md-6 ui-lg-3 form-group ">
								<h:outputText value="Destino/Localização:" />
								<p:autoComplete styleClass="font12-vi" size="45"
									panelStyle="width:180px" placeholder="Destino"
									value="#{viagemController.filtro.destino}"
									completeMethod="#{viagemController.completeLocalidade}"
									var="cidade" itemLabel="#{cidade.nome}" itemValue="#{cidade}"
									converter="localConverterVI" minQueryLength="3" />
							</div>

							<div class="ui-g-12 ui-md-6 ui-lg-3 form-group ">
								<h:outputText value="Missão:" />
								<p:inputText value="#{viagemController.filtro.missao}" />
							</div>

							<div class="ui-g-12 ui-md-6 ui-lg-3 form-group ">
								<h:outputText value="Diária:" />
								<p:inputText value="#{viagemController.filtro.codigoDaria}" />
							</div>

						</div>



						<div class="ui-g ui-fluid">
							<div class="ui-g-12 ui-lg-6 form-group">
								<h:outputText value="Descrição:" />
								<p:inputText value="#{viagemController.filtro.descricao}" />
							</div>

							<div class="ui-g-12 ui-lg-6 " style="text-align: right">
								<p:commandLink styleClass="btn btn-primary btn-sm"
									action="#{viagemController.filtrar()}" onclick="start()"
									onsuccess="stop()" onerror="stop()" update="table-viagem"
									style="color:#fff; margin: 8px 2px;">
									<span class="fa fa-fw fa-search"></span>
									<span>Procurar</span>
								</p:commandLink>

								<p:commandLink styleClass="btn btn-danger btn-sm"
									action="#{viagemController.limparFiltro()}"
									update="form-listagem" process="@this"
									style="color:#fff; margin: 8px 2px;">
									<span class="fa fa-fw fa-trash-o"></span>
									<span>Limpar fltro</span>
								</p:commandLink>

								<p:link styleClass="btn btn-success btn-sm"
									style="color:#fff;margin: 8px 2px;"
									outcome="/main/viagem_cadastro" title="Adicionar viagem">
									<span class="fa fa-fw fa-plus"></span>
									<span>Novo</span>
								</p:link>
								
								<p:commandLink styleClass="btn btn-primary btn-sm" update="dialog_help"
									oncomplete="PF('dialog_help').show();" onerror="stop();" onsuccess="stop();"
									onclick="start();"
									style="color:#fff; margin: 8px 2px;">
									<span class="fa fa-fw fa-question"></span>
									<span>Ajuda</span>
								</p:commandLink>
							</div>
						</div>


						<p:dataTable emptyMessage="Não há solicitaçoes de Viagem"
							paginator="true" rows="10" id="table-viagem"
							value="#{viagemController.viagems}" var="viagem"
							paginatorTemplate="{Exporters}  {CurrentPageReport}  
						{FirstPageLink} {PreviousPageLink} {PageLinks} 
						{NextPageLink} {LastPageLink} {RowsPerPageDropdown}">

							<p:column headerText="Codigo" style="width:5%"
								filterBy="SV#{viagem.id}" filterMatchMode="contains">

								<p:link value="SV#{viagem.id}" styleClass="link-content"
									style="margin-left:5px" outcome="/main/viagem_cadastro"
									title="Adicionar viagem">
									<f:param name="viagem" value="#{viagem.id}" />
									<span style="color: green; font-size: 25px;"
										class="icon-plus-alt"> </span>
								</p:link>

							</p:column>

							<p:column headerText="Missão" style="width:10%" filterBy="#{viagem.missao}"
								filterMatchMode="contains">
								<h:outputText value="#{viagem.missao}" />
							</p:column>

							<p:column headerText="Descrição" style="width:58%" filterBy="#{viagem.motivo}"
								filterMatchMode="contains">
								<h:outputText id="motivo"
									value="#{viagem.motivo}" />

							</p:column>


							<p:column headerText="Data" style="width:5%"
								filterBy="#{viagem.dataEmissao}">
								<h:outputText value="#{viagem.dataEmissao}">
									<f:convertDateTime pattern="dd/MM/yyy"
										timeZone="America/Manaus" />
								</h:outputText>
							</p:column>

							<p:column headerText="Solicitante" style="width:10%"
								filterBy="#{viagem.solicitante.nome.toLowerCase()}">
								<h:outputText value="#{viagem.solicitante.nome.toLowerCase()}" />
							</p:column>

							<p:column style="width:8%;text-align:center;"
								headerText="Opções">
								<p:menuButton value="Opções">
									<p:menuitem title="Imprimir"
										target="_blank" style="font-size: 1.4rem"
										ajax="false" styleClass="bg-warning"
										action="#{viagemController.gerarRelatorioViagem(viagem)}">
										<f:setPropertyActionListener value="#{compra}"
											target="#{compraController.compra}" />
										<span class="fa fa-fw fa-print p-2"></span>
										<span>Imprimir</span>
									</p:menuitem>
	
									<p:menuitem
										rendered="#{viagem.statusViagem == null or viagem.statusViagem.nome != 'Concluído'}"
										title="Excluir" style="font-size: 1.4rem"
										action="#{viagemController.remover()}"
										update="table-viagem,:form-listagem:msg-pagamento">
										<span class="fa fa-fw fa-trash-o p-2"></span>
										<span>Excluir</span>
										<f:setPropertyActionListener value="#{viagem}"
											target="#{viagemController.viagem}" />
									</p:menuitem>
								</p:menuButton>

							</p:column>
						</p:dataTable>
					</p:panel>
				</h:form>


			</h:panelGroup>

		</h:panelGroup>

	</ui:define>

	<ui:define name="adicionais">
	
		<p:dialog id="dialog_help" widgetVar="dialog_help" styleClass="help" header="Ajuda"
			showEffect="clip" hideEffect="drop" draggable="false" maximizable="true" minimizable="true" 
			resizable="true" blockScroll="true" onHide="unlockedScroll()" onShow="blockedScroll()" >
				<ui:include src="dialog/help/help_solicitacao_viagem.xhtml" />
		</p:dialog>

		<p:dialog modal="true" style="z-index:1000" widgetVar="statusDialog"
			showHeader="false" draggable="false" closable="false"
			resizable="false">
			<p:graphicImage library="image" name="aguarde.gif" />
			<p:graphicImage style="width:120px;height:70px" library="image"
				name="logofas.png" />
		</p:dialog>
	</ui:define>


</ui:composition>