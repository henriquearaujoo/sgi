<!DOCTYPE html>
<ui:composition template="/WEB-INF/LayoutFullPage.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:jsf="http://xmlns.jcp.org/jsf">

	<ui:define name="content">
		<script type="text/javascript">
			function start() {
			    PF('statusDialog').show();
			}
			 
			function stop() {
			    PF('statusDialog').hide();
			}


			
			$(document).ready(function(){
			  $('[data-toggle="tooltip"]').tooltip();   
			});
			

			
		</script>

		<style type="text/css">
.semBorda tr, .semBorda td {
	border: none !important;
}
</style>


		<h:panelGroup id="panel-content">

			<h:panelGroup id="panel-listagem"
						  rendered="#{viagemController.panelListagem}">

				<h:form id="form-listagem">
					<p:breadCrumb>
						<p:menuitem value="Categories" url="home_new.xhtml" />
						<p:menuitem value="Solicitação de viagem - listagem"
									url="SolicitacaoViagem.xhtml" />
					</p:breadCrumb>
					<p:messages id="msg-pagamento" showSummary="false"
								showDetail="true" showIcon="true" />

					<p:panel id="toggleable_viagem" header="Filtro" toggleable="true"
							 collapsed="false" closable="false" toggleSpeed="500"
							 closeSpeed="500" widgetVar="panel_compra"
							 style="margin-bottom:20px;">


						<p:panelGrid columns="6" styleClass="ui-noborder" >
							<h:outputText value="Código:" />
							<p:inputText value="#{viagemController.filtro.codigo}" />

							<h:outputText value="Missão:" />
							<p:inputText value="#{viagemController.filtro.missao}" />

							<h:outputText value="Solicitante:" />
							<p:inputText value="#{viagemController.filtro.nome}"
										 style="width:230px" />


							<h:outputText value="Dt. ínicio:" />
							<p:calendar id="dt_inicio" styleClass="font12-vi" size="10"
										value="#{viagemController.filtro.dataInicio}"
										timeZone="America/Manaus" navigator="true" pattern="dd/MM/yyyy" />

							<h:outputText value="Dt. final:" />
							<p:calendar id="dt_final" styleClass="font12-vi" size="10"
										value="#{viagemController.filtro.dataFinal}"
										timeZone="America/Manaus" navigator="true" pattern="dd/MM/yyyy" />

							<h:outputText value="Gestão:" />
							<p:autoComplete styleClass="font12-vi" panelStyle="width:180px"
											size="50" placeholder="Superintendencia/Coordenadoria/Regional"
											value="#{viagemController.filtro.gestao}"
											completeMethod="#{viagemController.completeGestao}" var="gestao"
											itemLabel="#{gestao.nome}" itemValue="#{gestao}"
											converter="gestaoConverterVI" minQueryLength="3" />


							<h:outputText value="Diária:" />
							<p:inputText value="#{viagemController.filtro.codigoDaria}" />

							<h:outputText value="Descrição:" />
							<p:inputText value="#{viagemController.filtro.descricao}" />

							<h:outputText value="Destino:" />
							<p:autoComplete styleClass="font12-vi" size="45"
											panelStyle="width:180px" placeholder="Destino"
											value="#{viagemController.filtro.destino}"
											completeMethod="#{viagemController.completeLocalidade}"
											var="cidade" itemLabel="#{cidade.nome}" itemValue="#{cidade}"
											converter="localConverterVI" minQueryLength="3" />

						</p:panelGrid>


						<p:commandLink styleClass="btn btn-primary btn-sm"
									   action="#{viagemController.filtrar()}" onclick="start()"
									   onsuccess="stop()" onerror="stop()" update="table-viagem"
									   style="color:#fff; margin: 8px 2px;">
							<i class="fa fa-search"></i>
							<span style="font-family: Arial">Procurar</span>
						</p:commandLink>

						<p:commandLink styleClass="btn btn-danger btn-sm"
									   action="#{viagemController.limparFiltro()}"
									   update="form-listagem" process="@this"
									   style="color:#fff; margin: 8px 2px;">
							<i class="fa fa-trash"></i>
							<span style="font-family: Arial"> Limpar filtro</span>
						</p:commandLink>

						<p:link styleClass="btn btn-success btn-sm"
								style="color:#fff;margin: 8px 2px;"
								outcome="/main/solicitacao_viagem_cadastro"
								title="Adicionar viagem">
							<i class="fa fa-plane"></i>
							<span style="font-family: Arial">Novo</span>
						</p:link>

					</p:panel>

					<p:dataTable emptyMessage="Não há solicitaçoes de Viagem"
								 paginator="true" rows="12" id="table-viagem"
								 value="#{viagemController.viagems}" var="viagem">

						<p:column headerText="Codigo" style="width:70px">

							<p:link value="SV#{viagem.id}" styleClass="link-content"
									style="margin-left:5px"
									outcome="/main/solicitacao_viagem_cadastro"
									title="Adicionar viagem">
								<f:param name="viagem" value="#{viagem.id}" />
								<span style="color: green; font-size: 25px;"
									  class="icon-plus-alt"> </span>
							</p:link>

						</p:column>

						<p:column headerText="Missão" style="width:200px">
							<h:outputText value="#{viagem.missao}" />
						</p:column>

						<p:column headerText="Descrição">
							<h:outputText value="#{viagem.motivo}" />
						</p:column>

						<p:column headerText="Data" style="width:100px">
							<h:outputText value="#{viagem.dataEmissao}">
								<f:convertDateTime pattern="dd/MM/yyy" timeZone="America/Manaus" />
							</h:outputText>
						</p:column>

						<p:column headerText="Solicitante" style="width:200px">
							<h:outputText value="#{viagem.solicitante.nome.toLowerCase()}" />
						</p:column>

						<p:column style="width:90px;text-align:center;"
								  headerText="Opções">

							<p:commandLink title="Imprimir"
										   styleClass="btn btn-default btn-xs"
										   target="_blank" style="margin-left:9px;color:#000" ajax="false"
										   action="#{viagemController.gerarRelatorioViagem(viagem)}">
								<i class="fa fa-print"></i>
								<f:setPropertyActionListener value="#{compra}"
															 target="#{compraController.compra}"/>
							</p:commandLink>

							<p:commandLink style="color:#FFF;margin-left:5px"
										   rendered="#{viagem.statusViagem == null or viagem.statusViagem.nome != 'Concluído'}"
										   title="Excluir"
										   styleClass="btn btn-danger btn-xs"
										   action="#{viagemController.remover()}"
										   update="table-viagem,:form-listagem:msg-pagamento">
								<i class="fa fa-trash"></i>
								<f:setPropertyActionListener value="#{viagem}"
															 target="#{viagemController.viagem}"/>
							</p:commandLink>

						</p:column>

					</p:dataTable>

				</h:form>

			</h:panelGroup>


		</h:panelGroup>

	</ui:define>

	<ui:define name="adicionais">
	
		<p:dialog id="dialog_help" widgetVar="dialog_help" styleClass="help" header="Ajuda"
			showEffect="clip" hideEffect="drop" draggable="false" maximizable="true" minimizable="true" 
			resizable="true" blockScroll="true" onHide="unlockedScroll()" onShow="blockedScroll()" >
				<ui:include src="dialog/help/help_solicitacao_viagem.xhtml" />
		</p:dialog>

		<p:dialog modal="true" style="z-index:1000" widgetVar="statusDialog"
			showHeader="false" draggable="false" closable="false"
			resizable="false">
			<p:graphicImage library="image" name="aguarde.gif" />
			<p:graphicImage style="width:120px;height:70px" library="image"
				name="logofas.png" />
		</p:dialog>
	</ui:define>


</ui:composition>