<!DOCTYPE html>
<ui:composition template="/WEB-INF/LayoutFullPage.xhtml"
				xmlns="http://www.w3.org/1999/xhtml"
				xmlns:f="http://xmlns.jcp.org/jsf/core"
				xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:p="http://primefaces.org/ui"
				xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
				xmlns:jsf="http://xmlns.jcp.org/jsf">



	<ui:define name="content">


		<script type="text/javascript">
			function start() {
				PF('statusDialog').show();
			}

			function stop() {
				PF('statusDialog').hide();
			}

			function stopDlgfilter() {
				PF('dlg_filtro_compra').hide();
			}
		</script>

		<f:metadata>
			<f:viewAction action="#{compraController.init()}" />
		</f:metadata>


		<h:panelGroup id="panel-content">
			<h:form>
				<p:breadCrumb>
					<p:menuitem value="Categories" url="home_new.xhtml" />
					<p:menuitem value="Solicitação de compras - listagem"
								url="compras.xhtml" />
				</p:breadCrumb>
			</h:form>
			<p:tabView id="tab">
				<p:tab title="Solicitações">

					<!-- Painle de listagem -->
					<h:panelGroup id="panel-listagem"
								  rendered="#{compraController.panelListagem}">

						<h:form id="form-listagem">

							<p:messages id="msg-compra" showSummary="false" showDetail="true"
										closable="true" showIcon="true" />

							<p:panel id="toggleable_compra" header="Filtro" toggleable="true"
									 collapsed="false" closable="false" toggleSpeed="500"
									 closeSpeed="500" widgetVar="panel_compra"
									 style="margin-bottom:20px;">

								<p:panelGrid columns="1" styleClass="semBorda">
									<p:panelGrid columns="4" styleClass="semBorda"
												 style="width:100%">

										<h:panelGrid columns="1" styleClass="width-100-vi">
											<h:outputText value="Código:" />

											<p:inputText value="#{compraController.filtro.codigo}"
														 style="width:80px" styleClass="font12-vi" />

										</h:panelGrid>

										<h:panelGrid columns="1" styleClass="width-100-vi">
											<h:outputText value="Solicitante:" />
											<p:inputText value="#{compraController.filtro.nome}"
														 styleClass="font12-vi" />
										</h:panelGrid>

										<h:panelGrid columns="1" styleClass="width-100-vi">
											<h:outputText value="Dt. ínicio:" />
											<p:calendar id="dt_inicio" styleClass="font12-vi"
														value="#{compraController.filtro.dataInicio}"
														timeZone="America/Manaus" navigator="true"
														pattern="dd/MM/yyyy" />
										</h:panelGrid>

										<h:panelGrid columns="1" styleClass="width-100-vi">
											<h:outputText value="Dt. final:" style="margin-left:5px;" />
											<p:calendar id="dt_final" styleClass="font12-vi"
														value="#{compraController.filtro.dataFinal}"
														timeZone="America/Manaus" navigator="true"
														pattern="dd/MM/yyyy" />
										</h:panelGrid>

										<h:panelGrid columns="1" styleClass="width-100-vi">

											<h:outputText value="Gestão:" />
											<p:autoComplete styleClass="font12-vi"
															panelStyle="width:180px"
															placeholder="Superintendencia/Coordenadoria/Regional"
															value="#{compraController.filtro.gestao}"
															completeMethod="#{projetoBean.completeGestao}" var="gestao"
															itemLabel="#{gestao.nome}" itemValue="#{gestao}"
															converter="gestaoConverterVI" minQueryLength="3" />
										</h:panelGrid>

										<h:panelGrid columns="1" styleClass="width-100-vi">
											<h:outputText value="Destino/Localização:" for="destino" />
											<p:autoComplete styleClass="font12-vi" id="destino"
															panelStyle="width:180px" placeholder="Destino"
															value="#{compraController.filtro.localidade}"
															completeMethod="#{fornecedor_controller.completeLocalidade}"
															var="cidade" itemLabel="#{cidade.nome}"
															itemValue="#{cidade}" converter="localConverterVI"
															minQueryLength="3" />
										</h:panelGrid>

										<h:panelGrid columns="1" styleClass="width-100-vi">
											<h:outputText value="Produto:" />
											<p:inputText
													value="#{compraController.filtro.descricaoProduto}"
													styleClass="font12-vi" />
										</h:panelGrid>

										<h:panelGrid columns="1" styleClass="width-100-vi">
											<h:outputText value="Categoria:" style="margin-left:4px" />
											<p:selectOneMenu filter="true" filterMatchMode="contains"
															 value="#{compraController.filtro.categoriaID}">
												<f:selectItem noSelectionOption="true" />
												<f:selectItems value="#{compraController.categorias}"
															   var="categoria" itemLabel="#{categoria.nome}"
															   itemValue="#{categoria.id}" />
											</p:selectOneMenu>
										</h:panelGrid>

										<h:panelGrid columns="1" styleClass="width-100-vi">
											<h:outputText value="Urgência:" style="margin-left:4px" />
											<p:selectBooleanCheckbox
													value="#{compraController.filtro.urgencia}" label="Urgência"
													style="margin-left:4px">
											</p:selectBooleanCheckbox>
										</h:panelGrid>




									</p:panelGrid>


									<h:panelGroup>
										<p:commandLink
												styleClass="btn btn-primary btn-sm"
												action="#{compraController.filtrar()}" onclick="start()"
												onsuccess="stop()" onerror="stop()"
												update=":tab:form-listagem:table-compras"
												style="color:#fff; margin: 8px 2px;">
											<i class="fa fa-search"></i>
											<span style="font-family: Arial">Procurar</span>
										</p:commandLink>

										<p:commandLink
												styleClass="btn btn-danger btn-sm"
												action="#{compraController.limparFiltro()}"
												update=":tab:form-listagem" process="@this"
												style="color:#fff; margin: 8px 2px;">
											<i class="fa fa-trash-o"></i>
											<span style="font-family: Arial"> Limpar filtro</span>
										</p:commandLink>


										<p:commandLink
												styleClass="btn btn-success btn-sm"
												action="#{compraController.iniciarNovaCompra()}"
												update="panel-content" title="Adicionar compra"
												style="color:#fff; margin: 8px 2px;">
											<i class="fa fa-cart-plus"></i>
											<span style="font-family: Arial">Novo</span>
										</p:commandLink>

										<p:link rendered="false"
												styleClass="btn btn-success btn-sm fa fa-cart-plus"
												style="color:#fff;margin: 8px 2px;"
												outcome="/main/compra_cadastro"
												title="Adicionar solicitação de compra">
											<span style="font-family: Arial">Novo TESTE</span>
										</p:link>


									</h:panelGroup>

								</p:panelGrid>

							</p:panel>

							<p:dataTable id="table-compras"
										 paginatorTemplate="{CurrentPageReport} {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {RowsPerPageDropdown}"
										 emptyMessage="Não há solicitações de compra"
										 value="#{compraController.compras}" var="compra"
										 paginator="true" widgetVar="comprasTable" rows="10"
										 rowsPerPageTemplate="5,10,15,20,25,50,100">

								<p:column headerText="Código" style="width:95px"
										  filterBy="#{compra.id}" filterMatchMode="contains">
									<p:commandLink value="SC#{compra.id}"
												   action="#{compraController.editarCompraMODE01()}"
												   onclick="PrimeFaces.monitorDownload(start, stop);"
												   update="panel-content">
										<f:setPropertyActionListener value="#{compra}"
																	 target="#{compraController.compra}" />
									</p:commandLink>
								</p:column>

								<p:column headerText="Gestão" filterBy="#{compra.nomeGestao}"
										  filterMatchMode="contains">
									<h:outputText value="#{compra.nomeGestao}" />
								</p:column>

								<p:column headerText="Destino" filterBy="#{compra.nomeDestino}"
										  filterMatchMode="contains">
									<h:outputText value="#{compra.nomeDestino}" />
								</p:column>

								<p:column headerText="Data" style="width:150px">
									<h:outputText value="#{compra.dataEmissao}">
										<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss "
														   timeZone="America/Manaus" />
									</h:outputText>
								</p:column>

								<p:column headerText="Solicitante"
										  filterBy="#{compra.nomeSolicitante}" filterMatchMode="contains">
									<h:outputText value="#{compra.nomeSolicitante.toLowerCase()}" />
								</p:column>

								<p:column headerText="Status"
										  style="text-align:center;width:125px"
										  filterBy="#{compra.statusCompra.nome}"
										  filterMatchMode="contains">

									<h:outputText value="#{compra.statusCompra.nome}"
												  rendered="#{compra.statusCompra.nome.equals('Não iniciado/Solicitado')}" />

									<h:outputText styleClass="tamanho-status status-amarelo"
												  value="#{compra.statusCompra.nome}"
												  rendered="#{compra.statusCompra.nome.equals('Em cotação')}" />

									<h:outputText styleClass="tamanho-status status-azul"
												  value="#{compra.statusCompra.nome}"
												  rendered="#{compra.statusCompra.nome.equals('Autorizado')}" />


									<h:outputText styleClass="tamanho-status status-vermelho"
												  value="#{compra.statusCompra.nome}"
												  rendered="#{compra.statusCompra.nome.equals('Cancelado')}" />


									<h:outputText styleClass="tamanho-status status-verde"
												  value="#{compra.statusCompra.nome}"
												  rendered="#{compra.statusCompra.nome.equals('Parcialmente Concluído')}" />

									<h:outputText styleClass="tamanho-status status-verde"
												  value="#{compra.statusCompra.nome}"
												  rendered="#{compra.statusCompra.nome.equals('Concluído')}" />

									<h:outputText styleClass="tamanho-status status-verde"
												  value="#{compra.statusCompra.nome}"
												  rendered="#{compra.statusCompra.nome.equals('Logística')}" />

									<h:outputText styleClass="tamanho-status"
													value="#{compra.statusCompra.nome}"
													rendered="#{compra.statusCompra.nome.equals('1º autorização')}"/>

								</p:column>

								<p:column headerText="Categoria"
										  filterBy="#{compra.nomeCategoria}" filterMatchMode="contains"
										  style="width:225px">
									<h:outputText value="#{compra.nomeCategoria}" />
								</p:column>

								<p:column style="width:45px">
									<p:commandLink rendered="#{compra.bootUrgencia}">
										<span style="color: red" class="glyphicon glyphicon-alert"></span>
									</p:commandLink>
								</p:column>


								<p:column style="width:200px" rendered="false">

									<p:link title="Editar" rendered="false"
											style="color:#000;margin-left:9px;"
											styleClass="btn btn-default btn-xs glyphicon glyphicon-edit"
											outcome="/main/compra_cadastro">
										<f:param name="comp" value="#{compra.id}" />
									</p:link>

									<p:commandLink title="Pedidos"
												   style="color:#000;margin-left:9px;"
												   styleClass="btn btn-default btn-xs glyphicon glyphicon-shopping-cart"
												   update=":form-pedidos" oncomplete="PF('dlg_pedido').show()"
												   action="#{compraController.carregarPedidos()}">
										<f:setPropertyActionListener value="#{compra}"
																	 target="#{compraController.compra}" />
									</p:commandLink>


									<p:link title="Cotações" style="color:#000;margin-left:9px;"
											styleClass="btn btn-default btn-xs glyphicon glyphicon-usd"
											outcome="/main/cotacao">
										<f:param name="comp" value="#{compra.id}" />
									</p:link>



									<p:commandLink title="Enviar para aprovação"
												   styleClass="btn btn-default btn-xs glyphicon glyphicon-envelope"
												   style="margin-left:9px;color:#000" ajax="false"
												   update="panel-content :tab:form-listagem:msg-compra"
												   action="#{compraController.enviarSolicitacaoCompraEmail()}"
												   onclick="PrimeFaces.monitorDownload(start, stop);">
										<f:setPropertyActionListener value="#{compra}"
																	 target="#{compraController.compra}" />
									</p:commandLink>


									<p:commandLink title="Imprimir"
												   styleClass="btn btn-default btn-xs glyphicon glyphicon-print"
												   target="_blank" style="margin-left:9px;color:#000"
												   update="panel-content" ajax="false"
												   action="#{compraController.imprimir()}">
										<f:setPropertyActionListener value="#{compra}"
																	 target="#{compraController.compra}" />
									</p:commandLink>

									<p:commandLink title="Excluir" rendered="false"
												   update="table-compras" styleClass="fa fa-times"
												   style="font-size:14px;margin-left:12px"
												   action="#{compraController.cancelarCompra()}">
										<p:confirm header="Confirmar suspensão do pedido"
												   icon="ui-icon-alert"
												   message="Ao cancelar a compra todos os pagamentos serão cancelados. Deseja continuar?" />
										<f:setPropertyActionListener value="#{compra}"
																	 target="#{compraController.compra}" />
									</p:commandLink>

									<p:link
											styleClass="btn btn-default btn-xs glyphicon glyphicon-duplicate"
											value="" title="Selecionar fornecedor"
											outcome="/main/escolhaCotacaoBackup"
											style="margin-left:9px;color:#000">
										<f:param name="comp" value="#{compra.id}" />
									</p:link>

								</p:column>

								<p:column style="width:100px">
									<p:menuButton value="Opções" icon="fa fa-navicon">

										<p:menuitem update=":form-pedidos" icon="fa fa-cart-plus"
													oncomplete="PF('dlg_pedido').show()" value="Pedidos"
													onstart="start()" onsuccess="stop()" onerror="stop()"
													action="#{compraController.carregarPedidos(compra.id)}" />

										<p:menuitem icon="fa fa-dollar" value="Cotação"
													outcome="/main/cotacao">
											<f:param name="comp" value="#{compra.id}" />
										</p:menuitem>

										<p:menuitem icon="fa fa-envelope-o"
													value="Enviar para aprovação"
													update="panel-content :tab:form-listagem:msg-compra"
													actionListener="#{compraController.enviarSolicitacaoCompraEmail(compra)}"
													onstart="start()" onerror="stop()" oncomplete="stop()">
											<p:confirm header="Enviar para Aprovação"
													   icon="ui-icon-alert"
													   message="Enviar e-mail com solicitação para aprovação?" />

										</p:menuitem>

										<p:menuitem value="Imprimir" target="_blank"
													update="panel-content" ajax="false" icon="fa fa-print"
													action="#{compraController.imprimir(compra)}">
										</p:menuitem>

										<p:menuitem icon="fa fa-copy" value="Selecionar fornecedor"
													outcome="/main/escolhaCotacaoBackup">
											<f:param name="comp" value="#{compra.id}" />
										</p:menuitem>

										<p:menuitem target="_blank" icon="fa fa-file"
													value="Formulário de cotação" ajax="false"
													actionListener="#{compraController.imprimirFormulario(compra.id)}">

										</p:menuitem>

									</p:menuButton>

								</p:column>

							</p:dataTable>



							<p:confirmDialog global="true" showEffect="fade"
											 hideEffect="fade">
								<p:commandButton value="Sim" type="button"
												 styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
								<p:commandButton value="Não" type="button"
												 styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
							</p:confirmDialog>


						</h:form>
					</h:panelGroup>


					<h:panelGroup id="panel-cadastro"
								  rendered="#{compraController.panelCadastro}">

						<h:form id="form-cadastro">

							<p:confirmDialog global="true" showEffect="fade"
											 hideEffect="fade">
								<p:commandButton value="Sim" type="button"
												 styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
								<p:commandButton value="Não" type="button"
												 styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
							</p:confirmDialog>

							<div class="ui-fluid">

								<p:messages id="msgs" autoUpdate="false" showSummary="false"
											showDetail="true" showIcon="true" closable="true" />

								<div class="botao_central" align="right"
									 style="width: 100%; background-color: rgba(132, 154, 57, 0.09)">

									<p:commandLink styleClass="btn btn-primary btn-sm"
												   type="button" onclick="salvar()"
												   rendered="#{compraController.poderEditar()}"
												   style="color:#fff; margin: 2px 2px;" value="Salvar" />


									<p:commandLink styleClass="btn btn-success btn-sm"
												   type="button" rendered="#{compraController.poderEditar()}"
												   oncomplete="PF('dlg_aprovacao_coordenador').show()"
												   style="color:#fff; margin: 2px 2px;" value="Autorizar" />


									<p:commandLink styleClass="btn btn-danger btn-sm" type="button"
												   rendered="#{compraController.compra.id != null and !compraController.compra.statusCompra.nome.equals('Cancelado') and !compraController.compra.statusCompra.nome.equals('Concluído')}"
												   onclick="suspender()" style="color:#fff; margin: 2px 2px;"
												   value="Cancelar">
										<p:confirm header="Confirmar suspensão da solicitação"
												   icon="ui-icon-alert"
												   message="Ao cancelar a compra todos os pagamentos serão cancelados. Deseja continuar?" />

									</p:commandLink>

									<p:commandLink styleClass="btn btn-danger btn-sm" type="button"
												   rendered="#{compraController.compra.id != null and !compraController.compra.statusCompra.nome.equals('Autorizado') and compraController.poderEditar()}"
												   onclick="reabrir()" style="color:#fff; margin: 2px 2px;"
												   value="Reabrir">
										<p:confirm header="Confirmar reabertura da solicitação"
												   icon="ui-icon-alert" message="Reabrir solicitação de compra?" />

									</p:commandLink>

									<p:commandLink styleClass="btn btn-success btn-sm"
												   type="button"
												   rendered="#{compraController.compra.id != null and  compraController.poderEditar()}"
												   onclick="atualizar()" style="color:#fff; margin: 2px 2px;"
												   value="Atualizar Status">
									</p:commandLink>


									<p:commandLink action="#{compraController.voltarListagem()}"
												   value="voltar" update="panel-content" process="@this"
												   styleClass="btn btn-info btn-sm"
												   style="color:#fff; margin: 2px 2px;" />



								</div>


								<p:accordionPanel id="accordion_crud_solicitacao"
												  prependId="false">
									<p:tab>
										<f:facet name="title">
											<p:commandLink>
												<i class="fa fa-navicon"></i>
												<span style="font-family: Arial; font-size: 16px">Informações
													gerais</span>
											</p:commandLink>
										</f:facet>

										<p:panelGrid id="content_info_geral" style="width:100%"
													 columns="2" columnClasses="ui-grid-col-10, ui-grid-col-2">
											<h:panelGroup>
												<p:panelGrid columns="1" style="width:100%"
															 id="grid-cadastro">
													<p:panelGrid columns="4" style="width:100%"
																 id="grid-cadastro-compra">
														<f:facet name="header">
															<p:remoteCommand name="salvar" onstart="start()"
																			 onsuccess="stop()" onerror="stop()"
																			 update="grid-cadastro-compra :tab:form-cadastro :tab:form-cadastro:panel_local_compra :tab:form-cadastro:msgs :tab:form-cadastro:tabela-item :tab:form-cadastro:tab_lanc_acao"
																			 action="#{compraController.salvarCompraMODE01()}"
																			 process="grid-cadastro-compra :tab:form-cadastro:grid_obs :tab:form-cadastro:panel_local_compra" />

															<p:remoteCommand name="aprovar"
																			 update="grid-cadastro-compra :tab:form-cadastro:msgs :tab:form-cadastro:tabela-item"
																			 action="#{compraController.aprovar()}"
																			 process="grid-cadastro-compra" />

															<p:remoteCommand name="suspender" onstart="start()"
																			 onsuccess="stop()" onerror="stop()"
																			 update="grid-cadastro-compra :tab:form-cadastro :tab:form-cadastro:msgs :tab:form-cadastro:tabela-item :tab:form-cadastro:tab_lanc_acao"
																			 action="#{compraController.suspenderCompra()}"
																			 process="grid-cadastro-compra" />

															<p:remoteCommand name="reabrir" onstart="start()"
																			 onsuccess="stop()" onerror="stop()"
																			 update="grid-cadastro-compra :tab:form-cadastro :tab:form-cadastro:msgs :tab:form-cadastro:tabela-item :tab:form-cadastro:tab_lanc_acao"
																			 action="#{compraController.reabrir()}"
																			 process="grid-cadastro-compra" />

															<p:remoteCommand name="atualizar" onstart="start()"
																			 onsuccess="stop()" onerror="stop()"
																			 update="grid-cadastro-compra :tab:form-cadastro :tab:form-cadastro:msgs :tab:form-cadastro:tabela-item :tab:form-cadastro:tab_lanc_acao"
																			 action="#{compraController.atualizarStatusSC()}"
																			 process="grid-cadastro-compra" />

														</f:facet>

														<h:panelGrid id="codigo_solicitacao" columns="1"
																	 styleClass="semBorda">
															<p:outputLabel value="Solicitação:" />
															<p:inputText value="#{compraController.compra.id}"
																		 style="width:40%" disabled="true" />
														</h:panelGrid>

														<h:panelGrid id="codigo_gestao" columns="1"
																	 styleClass="width-100-vi semBorda">
															<p:outputLabel value="Gestão:" />
															<p:autoComplete styleClass="font12-vi"
																			panelStyle="width:180px" required="true"
																			requiredMessage="Preencha o campo 'Gestão'"
																			placeholder="Superintendencia/Coordenadoria/Regional"
																			value="#{compraController.compra.gestao}"
																			completeMethod="#{projetoBean.completeGestao}"
																			var="gestao" itemLabel="#{gestao.nome}"
																			itemValue="#{gestao}" converter="gestaoConverterVI"
																			minQueryLength="3" />

														</h:panelGrid>

														<h:panelGrid id="codigo_destino" columns="1"
																	 styleClass="width-100-vi semBorda">
															<p:outputLabel value="Destino:" />
															<p:autoComplete styleClass="font12-vi" required="true"
																			requiredMessage="Preencha o campo 'Destino'"
																			panelStyle="width:180px" placeholder="Destino"
																			value="#{compraController.compra.localidade}"
																			completeMethod="#{fornecedor_controller.completeLocalidade}"
																			var="cidade" itemLabel="#{cidade.nome}"
																			itemValue="#{cidade}" converter="localConverterVI"
																			minQueryLength="3" />

														</h:panelGrid>

														<h:panelGrid id="codigo_solicitante" columns="1">
															<p:outputLabel value="Solicitante:" />
															<h:outputText
																	value="#{compraController.compra.solicitante.nome}" />

														</h:panelGrid>

														<h:panelGrid id="codigo_escolha_justificativa" columns="1"
																	 styleClass="semBorda">
															<p:outputLabel value="Urgência:" />
															<h:panelGroup id="justific">
																<p:selectBooleanButton id="value2"
																					   value="#{compraController.compra.bootUrgencia}"
																					   onLabel="Sim" offLabel="Não" onIcon="ui-icon-check"
																					   offIcon="ui-icon-close" style="width:60px">
																	<p:ajax update=":tab:form-cadastro:grid_obs"></p:ajax>
																</p:selectBooleanButton>

															</h:panelGroup>

														</h:panelGrid>

														<h:panelGrid id="codigo_dt_emissao" columns="1">
															<p:outputLabel value="Data:" />
															<h:outputText
																	value="#{compraController.compra.dataEmissao}">
																<f:convertDateTime pattern="dd/MM/yyyy HH:mm:ss "
																				   timeZone="America/Manaus" />
															</h:outputText>
														</h:panelGrid>

														<h:panelGrid id="codigo_status" columns="1">

															<p:outputLabel value="Status:" />
															<h:outputText
																	value="#{compraController.compra.statusCompra.nome}"
																	rendered="#{compraController.compra.statusCompra.nome.equals('Não iniciado/Solicitado')}" />

															<h:outputText styleClass="tamanho-status status-amarelo"
																		  value="#{compraController.compra.statusCompra.nome}"
																		  rendered="#{compraController.compra.statusCompra.nome.equals('Em cotação')}" />

															<h:outputText styleClass="tamanho-status status-azul"
																		  value="#{compraController.compra.statusCompra.nome}"
																		  rendered="#{compraController.compra.statusCompra.nome.equals('Autorizado')}" />

															<h:outputText styleClass="tamanho-status status-vermelho"
																		  value="#{compraController.compra.statusCompra.nome}"
																		  rendered="#{compraController.compra.statusCompra.nome.equals('Cancelado')}" />

															<h:outputText styleClass="tamanho-status status-verde"
																		  value="#{compraController.compra.statusCompra.nome}"
																		  rendered="#{compraController.compra.statusCompra.nome.equals('Parcialmente Concluído')}" />

															<h:outputText styleClass="tamanho-status status-verde"
																		  value="#{compraController.compra.statusCompra.nome}"
																		  rendered="#{compraController.compra.statusCompra.nome.equals('Concluído')}" />

															<h:outputText styleClass="tamanho-status status-verde"
																		  value="#{compraController.compra.statusCompra.nome}"
																		  rendered="#{compraController.compra.statusCompra.nome.equals('Logística')}" />

														</h:panelGrid>



													</p:panelGrid>

												</p:panelGrid>

												<p:panelGrid id="panel_justific_obs" columns="2"
															 columnClasses="ui-grid-col-10, ui-grid-col-2"
															 style="width:100%">

													<p:panelGrid columns="2" style="width:100%" id="grid_obs"
																 columnClasses="ui-grid-col-2, ui-grid-col-10">
														<p:outputLabel value="Obs:" />
														<p:inputText value="#{compraController.compra.observacao}"
																	 style="width:100%" />

														<p:outputLabel value="Locais de compra:" />
														<h:outputText
																value="#{compraController.localDeCompra.toString()}" />

														<p:outputLabel value="Justificativa:"
																	   rendered="#{compraController.compra.bootUrgencia}" />
														<p:inputTextarea
																rendered="#{compraController.compra.bootUrgencia}"
																value="#{compraController.compra.justificativa}"
																placeholder="A justificativa é obrigatória em caso de urgência"
																cols="15" rows="4" />
													</p:panelGrid>

												</p:panelGrid>

											</h:panelGroup>

											<h:panelGrid id="panel_local_compra" columns="1">

												<h:outputText value="ONDE COMPRAR:" />
												<p:selectManyMenu id="advanced" scrollHeight="110"
																  value="#{compraController.municipiosDeCompraSelected}"
																  converter="localConverter" var="municipo_select"
																  filter="true" filterMatchMode="contains"
																  showCheckbox="true">

													<f:selectItems
															value="#{compraController.municipiosDeCompra}"
															var="municipio" itemLabel="#{municipio.nome}"
															itemValue="#{municipio}" />

													<p:column>
														<h:outputText value="#{municipo_select.nome}" />
													</p:column>

												</p:selectManyMenu>
											</h:panelGrid>


										</p:panelGrid>

										<p:dataTable id="tabela-item"
													 rowStyleClass="#{item.cancelado ? 'highlight_red' : null} "
													 style="margin-left:auto;margin-right:auto"
													 emptyMessage="Não há itens"
													 value="#{compraController.compra.itens}" var="item"
													 rowIndexVar="indexRow">

											<f:facet name="header">
												<p:panelGrid id="itemCompraGrid"
															 columnClasses="ui-grid-col-2,ui-grid-col-4,ui-grid-col-3,ui-grid-col-2,ui-grid-col-2"
															 columns="5" layout="grid">
													<f:facet name="header">
														<p:focus context="itemCompraGrid" />

													</f:facet>

													<p:inputText required="true"
																 requiredMessage="Preencha a quantidade de produtos"
																 value="#{compraController.itemCompra.quantidade}"
																 placeholder="Qtd." />

													<p:autoComplete id="produto_compra" required="true"
																	placeholder="Descrição do item"
																	panelStyle="width:100%;height:200px"
																	requiredMessage="Preencha o campo Produto" size="50"
																	value="#{compraController.itemCompra.produto}"
																	completeMethod="#{compraController.completeProduto}"
																	var="produto" itemLabel="#{produto.descricao}"
																	itemValue="#{produto}" converter="produtoConverter"
																	forceSelection="true"/>

													<p:inputText placeholder="Descrição complementar"
																 style="width:100%"  maxlength="255"
																 value="#{compraController.itemCompra.descricaoComplementar}">
													</p:inputText>

													<p:commandLink
															styleClass="btn btn-success btn-xm"
															style="color:#FFF; height:28px"
															rendered="#{compraController.poderEditar()}"
															update="@parent :tab:form-cadastro:msgs :tab:form-cadastro:tabela-item"
															action="#{compraController.addItem()}"
															process="itemCompraGrid">

														<i class="fa fa-save"></i>
													</p:commandLink>

												</p:panelGrid>

											</f:facet>

											<p:column headerText="Descrição" style="width:20%">
												<h:outputText value="#{item.produto.descricao}" />
											</p:column>

											<p:column headerText="Descrição complementar"
													  style="width:20%">
												<h:outputText value="#{item.descricaoComplementar}" />
											</p:column>

											<p:column headerText="Und.compra" style="width:10%">
												<h:outputText value="#{item.unidade}" />
											</p:column>

											<p:column headerText="Categoria" style="width:10%">
												<h:outputText value="#{item.produto.categoriaDespesa.nome}" />
											</p:column>


											<p:column headerText="Tipo" style="width:10%">
												<h:outputText value="#{item.produto.tipo}" />
											</p:column>

											<p:column headerText="Qtd." style="width:5%">
												<h:outputText value="#{item.quantidade}" style="float:right" />
											</p:column>


											<p:column style="width:95px">

												<p:commandLink title="Editar"
															   styleClass="btn btn-default btn-xs"
															   action="#{compraController.removerItem(indexRow)}"
															   rendered="#{compraController.poderEditar()}"
															   process="@this" update="tabela-item">
													<i class="fa fa-pencil"></i>
													<f:setPropertyActionListener value="#{item}"
																				 target="#{compraController.itemCompra}" />

												</p:commandLink>

												<p:commandLink title="excluir"
															   style="color:#fff;margin-left:5px"
															   styleClass="btn btn-danger btn-xs"
															   action="#{compraController.removerItem(indexRow)}"
															   rendered="#{compraController.poderEditar()}"
															   process="@this" update="tabela-item">
													<i class="fa fa-trash"></i>
													<p:confirm message="Excluir item?" />
													<f:setPropertyActionListener value="#{item}"
																				 target="#{compraController.itemCompra}" />

												</p:commandLink>
											</p:column>

										</p:dataTable>

									</p:tab>

									<p:tab rendered="false">

										<f:facet name="title">
											<p:commandLink
													styleClass="glyphicon glyphicon-menu-hamburger">
												<span style="font-family: Arial; font-size: 16px">Fonte
													pagadora/Ação</span>
											</p:commandLink>
										</f:facet>

										<h:panelGroup id="itemCompra">

											<p:dataTable id="tab_lanc_acao" var="lac_acao"
														 value="#{compraController.compra.lancamentosAcoes}"
														 style="width:100%">


												<f:facet name="header">
													<p:outputPanel id="lancamento_acao">

														<p:autoComplete id="fonte_pagadora_compra"
																		placeholder="Fonte pagadora" size="150"
																		style="width:150px"
																		value="#{compraController.lancamentoAcao.fontePagadora}"
																		completeMethod="#{compraController.completeFonte}"
																		var="fontePagadora" itemLabel="#{fontePagadora.nome}"
																		itemValue="#{fontePagadora}"
																		converter="fontePagadoraConverter" forceSelection="true" />

														<p:autoComplete id="acao_compra" placeholder="Ação"
																		style="width:150px;margin-left:5px" size="150"
																		value="#{compraController.lancamentoAcao.acao}"
																		completeMethod="#{compraController.completeAcoes}"
																		var="acao" itemLabel="#{acao.codigo}" itemValue="#{acao}"
																		converter="acaoConverter" forceSelection="true" />

														<p:commandLink
																styleClass="btn btn-success btn-xm fa fa-save"
																process="lancamento_acao" type="button"
																update="tab_lanc_acao"
																action="#{compraController.adicionarNovaAcao()}"
																style="color:#fff; margin: 2px 2px; height:28px">
															<span style="font-family: Arial">Adicionar</span>
														</p:commandLink>

													</p:outputPanel>
												</f:facet>

												<p:column headerText="Fonte pagadora">
													<h:outputText value="#{lac_acao.fontePagadora.nome}" />
												</p:column>

												<p:column headerText="Ação">
													<h:outputText value="#{lac_acao.acao.codigo}" />
												</p:column>

												<p:column style="width:50px;">
													<p:commandLink action="#{compraController.removerAcao()}"
																   process="@this" update="tab_lanc_acao">
														<i class="fa fa-trash"></i>
														<f:setPropertyActionListener value="#{lac_acao}"
																					 target="#{compraController.lancamentoAcao}" />
														<span class="fa fa-times"></span>
													</p:commandLink>
												</p:column>

											</p:dataTable>

										</h:panelGroup>
									</p:tab>

									<p:tab>

										<f:facet name="title">
											<p:commandLink>
												<i class="fa fa-navicon"></i>
												<span style="font-family: Arial; font-size: 16px">Linhas
													orçamentárias</span>
											</p:commandLink>
										</f:facet>



										<br />

										<p:dataTable id="tab_rubrica_proejto" var="lac_acao"
													 rowIndexVar="index"
													 value="#{compraController.compra.lancamentosAcoes}"
													 style="width:100%">

											<f:facet name="header">
												<p:outputPanel id="lancamento_acao">

													<p:messages id="msg_lancamento_acao" showDetail="true"
																showSummary="false" autoUpdate="false" closable="true" />


													<p:panelGrid columns="4" styleClass="semBorda">

														<h:panelGrid id="projeto" columns="1">
															<h:outputText value="Projetos1: " />
															<p:selectOneMenu value="#{compraController.projetoAux}"
																			 style="width:180px" filter="true"
																			 filterMatchMode="contains" converter="projetoConverter">
																<f:selectItem noSelectionOption="true" />
																<f:selectItems value="#{compraController.listaProjeto}"
																			   var="projeto" itemLabel="#{projeto.nome}"
																			   itemValue="#{projeto}" />
																<p:ajax update="lancamento_acao" onstart="start()"
																		onerror="stop()" onsuccess="stop()"
																		listener="#{compraController.listaRubricasAndAtividades()}" />
															</p:selectOneMenu>
														</h:panelGrid>

														<h:panelGrid id="panel_linha" columns="1"
																	 rendered="#{compraController.projetoAux != null}">
															<h:outputText value="Linha orçamentária: " />

															<p:selectOneMenu id="cate_compra" style="width:180px"
																			 placeholder="Entre com o código/nome do projeto."
																			 size="25"
																			 value="#{compraController.lancamentoAcao.projetoRubrica}"
																			 filter="true" filterMatchMode="contains" var="categoria"
																			 converter="projetoRubricaConverter">

																<f:selectItems
																		value="#{compraController.listaDeRubricasProjeto}"
																		var="ru" itemLabel="#{ru.nomeCategoria}"
																		itemValue="#{ru}" />




																<p:column headerText="Código">
																	<h:outputText value="#{categoria.codigo}" />
																</p:column>

																<p:column headerText="Fonte">
																	<h:outputText value="#{categoria.nomeFonte}" />
																</p:column>

																<p:column headerText="Projeto">
																	<h:outputText value="#{categoria.nomeProjeto}" />
																</p:column>

																<p:column headerText="Componente">
																	<h:outputText value="#{categoria.nomeComponente}" />
																</p:column>

																<p:column headerText="SubComponente">
																	<h:outputText value="#{categoria.nomeSubComponente}" />
																</p:column>

																<p:column headerText="Linha orçamentária">
																	<h:outputText value="#{categoria.nomeCategoria}" />
																</p:column>

																<p:column headerText="Saldo">
																	<h:outputText value="#{categoria.valorSaldo}">
																		<f:convertNumber currencySymbol="R$:"
																						 minFractionDigits="2" maxFractionDigits="2"
																						 locale="pt_BR" />
																	</h:outputText>
																</p:column>


															</p:selectOneMenu>
														</h:panelGrid>

														<h:panelGrid id="panel_atividades" columns="1"
																	 rendered="false">
															<h:outputText value="Atividades:  " />

															<p:selectOneMenu id="listaAtividades" style="width:180px"
																			 size="25" converter="atividadeProjetoConverter"
																			 value="#{compraController.lancamentoAcao.atividade}"
																			 filter="true" filterMatchMode="contains" var="atividade">

																<f:selectItems
																		value="#{compraController.listaAtividades}" var="at"
																		itemLabel="#{at.nome}" itemValue="#{at}" />


																<p:column headerText="Nome">
																	<p:outputLabel value="#{atividade.nome}" />
																</p:column>

																<p:column headerText="Total">
																	<p:outputLabel value="#{atividade.valor}">
																		<f:convertNumber currencySymbol="R$:"
																						 minFractionDigits="2" maxFractionDigits="2"
																						 locale="pt_BR" />
																	</p:outputLabel>
																</p:column>

																<p:column headerText="Saldo">
																	<p:outputLabel value="#{atividade.saldo}">
																		<f:convertNumber currencySymbol="R$:"
																						 minFractionDigits="2" maxFractionDigits="2"
																						 locale="pt_BR" />
																	</p:outputLabel>
																</p:column>



															</p:selectOneMenu>
														</h:panelGrid>


														<h:panelGrid columns="1" styleClass="width-100-vi"
																	 rendered="#{compraController.projetoAux != null}">
															<h:outputText value=":: " />
															<p:commandLink onclick="start()" id="teste2"
																		   onerror="stop()" oncomplete="stop()"
																		   styleClass="btn btn-success btn-xm fa fa-save"
																		   process="lancamento_acao" type="button"
																		   update="tab_rubrica_proejto"
																		   action="#{compraController.adicionarNovaAcao()}"
																		   style="color:#fff; margin: 2px 2px; height:28px">
																<span style="font-family: Arial">Adicionar</span>
															</p:commandLink>
														</h:panelGrid>

													</p:panelGrid>

												</p:outputPanel>

											</f:facet>

											<p:column headerText="Código">
												<h:outputText
														value="#{lac_acao.projetoRubrica.projeto.codigo}" />
											</p:column>

											<p:column headerText="Projeto">
												<h:outputText
														value="#{lac_acao.projetoRubrica.projeto.nome}" />
											</p:column>

											<p:column headerText="Doação">
												<h:outputText
														value="#{lac_acao.projetoRubrica.rubricaOrcamento.orcamento.titulo}" />
											</p:column>

											<p:column headerText="Linha orçamentária">
												<h:outputText
														value="#{lac_acao.projetoRubrica.rubricaOrcamento.rubrica.nome}" />
											</p:column>
											<p:column headerText="Atividade">
												<h:outputText value="#{lac_acao.atividade.nome}" />
											</p:column>

											<p:column style="width:50px;">
												<p:commandLink
														action="#{compraController.removerAcao(index)}"
														process="@this" update="tab_rubrica_proejto">
													<f:setPropertyActionListener value="#{lac_acao}"
																				 target="#{compraController.lancamentoAcao}" />
													<span class="fa fa-times"></span>
												</p:commandLink>
											</p:column>

										</p:dataTable>



									</p:tab>


								</p:accordionPanel>
							</div>

						</h:form>
					</h:panelGroup>

				</p:tab>

				<p:tab title="Solicitações Detalhadas">
					<ui:include src="/WEB-INF/sc_detalhada.xhtml" />
				</p:tab>


			</p:tabView>

		</h:panelGroup>




	</ui:define>

	<ui:define name="adicionais">


		<p:dialog header="Pedidos" widgetVar="dlg_pedido" modal="true"
				  showEffect="clip" hideEffect="clip" closable="true"
				  closeOnEscape="true">

			<h:form id="form-pedidos">
				<p:dataTable id="table_pedido"
							 rowStyleClass="#{pedido.statusCompra.nome.equals('Cancelado') ? 'highlight_red' : null} "
							 tableStyle="width:auto" styleClass="ui-fluid"
							 value="#{compraController.pedidos}" var="pedido">

					<p:column headerText="Código">
						<h:outputText value="#{pedido.id}" />
					</p:column>

					<p:column headerText="Fornecedor">
						<h:outputText value="#{pedido.fornecedor.nomeFantasia}" />
					</p:column>

					<p:column headerText="Gerador do pedido">
						<h:outputText value="#{pedido.usuarioGeradorPedido.nomeUsuario}" />
					</p:column>

					<p:column headerText="Valor">
						<h:outputText value="#{pedido.valorTotalSemDesconto}">
							<f:convertNumber type="currency" locale="pt_BR" />
						</h:outputText>
					</p:column>

					<p:column headerText="Valor c/ desconto">
						<h:outputText value="#{pedido.valorTotalComDesconto}">
							<f:convertNumber type="currency" locale="pt_BR" />
						</h:outputText>
					</p:column>

					<p:column>

						<p:link title="Editar" target="_blank"
								styleClass="btn btn-default btn-xs"
								outcome="/main/pedidoCadastro">
							<i class="fa fa-pencil"></i>
							<f:param name="ped" value="#{pedido.id}" />
						</p:link>

						<p:commandLink title="Imprimir"
									   styleClass="btn btn-default btn-xs"
									   target="_blank" style="margin-left:9px;" ajax="false"
									   action="#{pedidoController.imprimirPedido()}">
							<i class="fa fa-print"></i>
							<f:setPropertyActionListener value="#{pedido}"
														 target="#{pedidoController.pedido}" />
						</p:commandLink>

						<p:commandLink title="Notas"
									   oncomplete="PF('dialog_arquivo').show();" update=":form-arquivo"
									   action="#{pedidoController.carregarArquivos()}"
									   styleClass="btn btn-default btn-xs"
									   process="@this" style="margin-left:9px;">
							<i class="fa fa-file"></i>
							<f:setPropertyActionListener value="#{pedido}"
														 target="#{pedidoController.lancamentoAux}" />
						</p:commandLink>


						<p:commandLink
								rendered="#{!pedido.statusCompra.nome.equals('Concluído')}"
								title="Excluir" update="@form" onstart="start()"
								onclick="start()" onsuccess="stop();PF('dlg_pedido').hide();"
								onerror="stop()"
								styleClass="btn btn-default btn-xs"
								style="margin-left:9px"
								action="#{pedidoController.removerPedido()}">
							<i class="fa fa-trash"></i>
							<p:confirm header="Confirmar suspensão do pedido"
									   icon="ui-icon-alert" message="Excluir pedido?" />
							<f:setPropertyActionListener value="#{pedido}"
														 target="#{pedidoController.pedido}" />
						</p:commandLink>

					</p:column>



				</p:dataTable>

			</h:form>
		</p:dialog>

		<p:dialog header="Anexos" modal="true" widgetVar="dialog_arquivo"
				  width="60%" hideEffect="clip" closeOnEscape="true" showEffect="clip">

			<h:form id="form-arquivo" enctype="multipart/form-data">
				<p:messages id="msg_aprouve" autoUpdate="false" showIcon="true"
							showSummary="false" showDetail="true" closable="true" />
				<p:panelGrid columns="1">

					<p:fileUpload label="Adicionar documento" update="panel_grid"
								  fileUploadListener="#{pedidoController.handleFileUpload}"
								  mode="advanced" skinSimple="true" auto="true"
								  sizeLimit="100000000"
								  allowTypes="/(\.|\/)(doc|docx|xls|xlsx|pdf)$/" />

					<p:panelGrid id="panel_grid" columns="4" styleClass="ui-fluid"
								 style="width:100%">
						<h:outputLabel value="Nome:" />
						<h:panelGroup>
							<p:inputText id="input_name_arq"
										 placeholder="Dê um nome ao anexo, um nome representativo Ex: NF09990"
										 value="#{pedidoController.arquivo.nome}" />
							<p:tooltip for="input_name_arq"
									   value="Adicione um nome para que
								possamos achar com facilidade o anexo,
								adicione o número do lançamento antes do nome
								ex: Pedido 19009  o anexo ficaria '19009-Autor. Pagto. NF - 00888' "
									   position="top" />
						</h:panelGroup>

						<p:outputLabel value="#{pedidoController.path}" />
						<h:panelGroup>
							<p:commandLink id="btn_add_arq"
										   action="#{pedidoController.adicionarArquivo()}"
										   process="form-arquivo" style="color:#000"
										   update="table-arquivo form-arquivo"
										   styleClass="btn btn-default btn-xs glyphicon glyphicon-check" />
							<p:tooltip id="toolTipGrow" for="btn_add_arq"
									   value="Salvar na lista de arquivos" position="top" />
						</h:panelGroup>
					</p:panelGrid>

					<p:dataTable id="table-arquivo" styleClass="ui-fluid"
								 value="#{pedidoController.lancamentoAux.arquivos}" var="arq">
						<p:column headerText="Nome" filterBy="#{arq.nome}"
								  filterMatchMode="contains">
							<h:outputText value="#{arq.nome}" />
						</p:column>

						<p:column style="width:100px">
							<p:commandLink id="btn_visualizar" style="color:#000"
										   styleClass="btn btn-default btn-xs glyphicon glyphicon-search"
										   action="#{pedidoController.visualizarArquivo()}" target="_blank"
										   ajax="false" process="@this">
								<f:setPropertyActionListener value="#{arq}"
															 target="#{pedidoController.arqAuxiliar}" />
							</p:commandLink>
							<p:tooltip for="btn_visualizar" value="Visualisar anexo"
									   position="top" />

							<p:commandLink id="btn_excluir"
										   style="color:#000;margin-left:9px"
										   styleClass="btn btn-default btn-xs glyphicon glyphicon-remove-circle"
										   action="#{pedidoController.removerArquivo()}" process="@this"
										   update="table-arquivo :form-arquivo:msg_aprouve">
								<f:setPropertyActionListener value="#{arq}"
															 target="#{pedidoController.arqAuxiliar}" />
							</p:commandLink>
							<p:tooltip for="btn_excluir" value="Excluir anexo" position="top" />

						</p:column>

					</p:dataTable>



				</p:panelGrid>
			</h:form>

		</p:dialog>



		<p:dialog header="Autorização" widgetVar="dlg_aprovacao_coordenador"
				  modal="false" showEffect="clip" hideEffect="clip">
			<h:form id="form_aprovacao">

				<p:panelGrid columns="2">
					<h:outputText value="Senha:" />
					<p:password value="#{compraController.aprouve.senha}" />
					<p:commandLink process="form_aprovacao"
								   update="form_aprovacao :tab:form-cadastro :tab:form-cadastro:msgs"
								   styleClass="btn btn-primary" style="color:#ffffff"
								   onclick="PrimeFaces.monitorDownload(start, stop);"
								   action="#{compraController.aprovar()}" value="Enviar"></p:commandLink>
				</p:panelGrid>
			</h:form>
		</p:dialog>

		<p:dialog header="Email" widgetVar="dlg_email_compra" modal="false"
				  height="20%" width="50%" showEffect="clip" hideEffect="clip">
			<h:form style="with:100%">
				<p:panelGrid columns="2">
					<h:outputText value="Destinatário(s):" />
					<p:inputText required="true"
								 requiredMessage="É necessário prrencimento do campo."
								 style="width:450px;margin-left:auto;margin-right:auto"
								 value="#{compraController.email.toEmail}" />
					<p:commandLink styleClass="btn btn-primary" style="color:#ffffff"
								   value="Enviar"
								   action="#{compraController.enviarSolicitacaoCompraEmail()}"
								   update=":panel-content :tab:form-listagem:msg-compra" />
				</p:panelGrid>
			</h:form>
		</p:dialog>


		<p:dialog modal="true" style="z-index:1000" widgetVar="statusDialog"
				  showHeader="false" draggable="false" closable="false"
				  resizable="false">
			<p:graphicImage library="image" name="aguarde.gif" />
			<p:graphicImage style="width:120px;height:70px" library="image"
							name="logofas.png" />
		</p:dialog>

	</ui:define>


</ui:composition>