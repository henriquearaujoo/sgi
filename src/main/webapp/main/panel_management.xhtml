<!DOCTYPE html>
<ui:composition template="/WEB-INF/LayoutFullPage.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:jsf="http://xmlns.jcp.org/jsf" xmlns:o="http://omnifaces.org/ui">

	<ui:define name="content">




		<div class="container-fluid mb-3">
			<f:metadata>
				<f:viewAction action="#{panelManagement.execute()}" />
			</f:metadata>

			<h:form id="content" styleClass="default-style-form-filter">

				<script
					src="https://cdn.jsdelivr.net/npm/chartjs-plugin-datalabels@0.5.0"></script>

				<script type="text/javascript">
	             function chartExtender() {

	               var options = $.extend(true, {}, this.cfg.config);
	               options = {
	            	  plugins: [ChartDataLabels],
	                  options: {
	                      legend: {
	                         display: true,
	                      },
	                      plugins: {
	                          datalabels: {
	                            color: '#000',
	                            align: 'right',
	                            font: {
		                            size: '14'
		                            }
	                          }
	                        },
	                    },
	                    data: {
	                        datasets: [{
	                          datalabels: {
	                            color: '#000000'
	                          },
	                          data: this.cfg.config.data.datasets[0].data.map(item => item.toFixed(0))
	                        }, 
	                        {
		                      datalabels: {
		                            color: '#000000'
		                          }
		                       }
	                        ]
	                      },

	                      
	               };
	               $.extend(true, this.cfg.config, options);

	               //console.log(this.cfg.config);
	            };

	            function evolutionExtender() {
		               var chart = $.extend(true, {}, this.cfg.config);
		               chart = {
		 	            	  //plugins: [ChartDataLabels],
		 	                  options: {
			 	                  animation:{duration: 1500},
		 	                      legend: {
		 	                         display: true,
		 	                      },
		 	                      plugins: {
		 	                          datalabels: {
		 	                            color: '#000',
		 	                            align: 'left',
		 	                            font: {
		 		                            size: '18'
		 		                            }
		 	                          }
		 	                        },
		 	                        
		 	                    },
		 	                   data: {
			                        datasets: [{
			                          datalabels: {
			                            color: '#000000'
			                          },
			                        }, 
			                        {
				                      datalabels: {
				                            color: '#FFF',
				                            align: 'right',
				                            font: {
												size:'1'
					                            }
				                          }
				                       }
			                        ]
			                      },
		 	               };

		               
		               $.extend(true, this.cfg.config, chart);
		               console.log(this.cfg.config);
		            };

		            function pieExtender() {
			               var chart = $.extend(true, {}, this.cfg.config);
			               chart = {
			 	            	  //plugins: [ChartDataLabels],
			 	                  options: {
				 	                  animation:{duration: 1500},
			 	                      legend: {
			 	                         display: true,
			 	                      },
			 	                      plugins: {
			 	                          datalabels: {
			 	                            color: '#fff',
			 	                            align: 'center',
			 	                            font: {
			 		                            size: '18'
			 		                            },
			 		                        formatter: (value, ctx) => {
			 		                              let sum = 0;
			 		                              let dataArr = ctx.chart.data.datasets[0].data;
			 		                              dataArr.map(data => {
			 		                                  sum += data;
			 		                              });
			 		                              let percentage = (value*100 / sum).toFixed(0)+"%";
			 		                              return percentage;
			 		                        }
			 	                          }
			 	                        },
			 	                        
			 	                    }
			 	               };

			               
			               $.extend(true, this.cfg.config, chart);
			               //console.log(this.cfg.config);
			            };
			            

	           </script>

				<p:breadCrumb>
					<p:menuitem value="Home" url="home_new.xhtml" />
					<p:menuitem value="Painel do gestor" url="#" />
				</p:breadCrumb>

				<div style="margin: 0 auto 0 auto; width: 95%;">
					<div class="ui-g ui-fluid">

						<div class="ui-g-12"
							style="color: #000; margin-bottom: 10px; text-align: center; font-size: 16px; font-family: Courier New">
							Olá, seja bem vindo à versão de testes do painel de monitoramento
							de dados financeiros, nesse primeiro momento nós temos a <strong>Evolução
								financeira</strong> com duas séries representando o <strong>planejado</strong>
							e <strong>efetivado</strong> e a <strong>Porcentagem de
								execução</strong> calculada sem adição das verbas provisionadas. Os
							filtros contidos nessa seção se aplicam a todos os gráficos e os
							valores são sempre calculados dentro de um <strong>período
								de 12 meses</strong> filtrando de acordo com o <strong>ano</strong>
							escolhido.


						</div>

						<div class="ui-g-12">
							<div class="ui-g-3">
								<p:selectOneMenu id="ges"
									value="#{panelManagement.filtro.gestao}" autoWidth="false">
									<f:selectItem itemLabel="Gestões" noSelectionOption="true" />
									<f:selectItems value="#{panelManagement.gestoes}" var="ges"
										itemLabel="#{ges.nome}" itemValue="#{ges.id}" />
									<p:ajax event="itemSelect" update="content"
										listener="#{panelManagement.execute()}"></p:ajax>
								</p:selectOneMenu>

							</div>


							<div class="ui-g-3">
								<p:selectOneMenu id="select_ano"
									value="#{panelManagement.filtro.ano}" editable="true">
									<f:selectItem itemLabel="Selecione o ano" itemValue="" />
									<f:selectItem itemLabel="2018" itemValue="2018" />
									<f:selectItem itemLabel="2019" itemValue="2019" />
									<f:selectItem itemLabel="2020" itemValue="2020" />
									<f:selectItem itemLabel="2021" itemValue="2021" />
									<f:selectItem itemLabel="2022" itemValue="2022" />
									<f:selectItem itemLabel="2023" itemValue="2023" />
									<p:ajax event="itemSelect" update="content"
										listener="#{panelManagement.execute()}"></p:ajax>
								</p:selectOneMenu>
							</div>

							<div class="ui-g-3">
								<p:selectOneMenu id="fonte"
									value="#{panelManagement.filtro.idFonte}">
									<f:selectItem itemLabel="Selecione uma fonte"
										noSelectionOption="true" />
									<f:selectItems var="fonte" itemLabel="#{fonte.nome}"
										itemValue="#{fonte.id}" value="#{panelManagement.fontes}" />

									<p:ajax event="itemSelect" update="content"
										listener="#{panelManagement.execute()}"></p:ajax>
								</p:selectOneMenu>
							</div>
							<div class="ui-g-3">
								<p:selectOneMenu id="proj"
									value="#{panelManagement.filtro.idProjeto}" autoWidth="false">
									<f:selectItem itemLabel="Selecione um projeto"
										noSelectionOption="true" />
									<f:selectItems var="project" itemLabel="#{project.name}"
										itemValue="#{project.id}" value="#{panelManagement.projetos}" />
									<p:ajax event="itemSelect" update="content"
										listener="#{panelManagement.execute()}"></p:ajax>
								</p:selectOneMenu>
							</div>

							<div class="ui-g-12" style="margin-top: 15px">
								<p:selectBooleanCheckbox value="#{panelManagement.show}"
									itemLabel="Mostrar projetos de gestõtes abaixo na hierarquia">
									<p:ajax update="content"
										listener="#{panelManagement.execute()}" />
								</p:selectBooleanCheckbox>
							</div>
						</div>

						<div class="ui-g-8" style="text-align: center;">
							<h3>Evolução Financeira</h3>
							<div>
								<p:barChart model="#{panelManagement.evolutionFinanceModel}"
									style="width: 100%; height: 400px;" />
							</div>
						</div>

						<div class="ui-g-4" style="text-align: center;">
							<h3>Poercentagem de execução</h3>
							<div style="margin-top: 36px">
								<p:knob value="#{panelManagement.valuePercentExection}"
									id="knob" foregroundColor="#188826cf" width="325" height="325"
									disabled="true" labelTemplate="{value}%" max="100">
								</p:knob>
							</div>
						</div>
						
						<div class="d-flex justify-content-end flex-grow-1">
							<p:commandLink styleClass="btn btn-primary btn-sm">
								<span>Extrado</span>
							</p:commandLink>
						</div>
					</div>


					<div class="ui-g ui-fluid"
						style="margin-top: 136px; margin-bottom: 76px">

						<div class="ui-g-12"
							style="color: #000; margin-bottom: 10px; text-align: center; font-size: 16px; font-family: Courier New">
							Essa sessão traz as <strong>Fontes da Gestão</strong>, <strong>fontes
								de recursos</strong> que indiretamente a <strong>Gestão</strong> deverá
							prestar conta, nesse gráfico nós temos 3 séries que representam
							respectivamente <Strong>Orçamento</Strong>, todo o orçamento da
							gestão ou conjuntos de gestões, <strong>Empenhado</strong>, valor
							que representa quanto (R$) em relação ao orçamento já houve
							emprenho e não pode mais ser usado e o <strong>Efetivado</strong>,
							que representa quanto (R$) em relação ao empenho foi pago e saiu
							dos caixas da FAS. E o <strong>Status de pagamento</strong> que
							traz uma divisão por status de pagamento em relação ao total do
							orçamento.
						</div>

						<div class="ui-g-8" style="text-align: center;">
							<h3>Fontes/Parceiros da Gestão</h3>
							<div>
								<p:barChart model="#{panelManagement.hbarModel}"
									style="width: 100%; height: 400px;" />
							</div>
						</div>

						<div class="ui-g-4" style="text-align: center;">
							<h3>Status de pagamento</h3>
							<div style="margin-top: 36px">
								<p:pieChart model="#{panelManagement.pieModel}"
									style="width: 100%; height: 350px;" />
							</div>
						</div>
					</div>
				</div>

			</h:form>
		</div>
	</ui:define>

	<ui:define name="adicionais">
		<p:dialog modal="true" style="z-index:1000" widgetVar="statusDialog"
			showHeader="false" draggable="false" closable="false"
			resizable="false">
			<p:graphicImage library="image" name="aguarde.gif" />
			<p:graphicImage style="width:120px;height:70px" library="image"
				name="logofas.png" />
		</p:dialog>
	</ui:define>

</ui:composition>