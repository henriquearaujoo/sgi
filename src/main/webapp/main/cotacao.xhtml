<!DOCTYPE html>
<ui:composition template="/WEB-INF/LayoutFullPage.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:jsf="http://xmlns.jcp.org/jsf" xmlns:o="http://omnifaces.org/ui">


	<ui:define name="content">

		<h:form id="form-cotacao" prependId="false">

			<f:metadata>
				<o:viewParam name="comp" value="#{cotacaoController.compra}" />
				<f:viewAction action="#{cotacaoController.carregarItens()}" />
			</f:metadata>

			<p:messages id="message_cotacao" showSummary="false"
				showDetail="true" closable="true">
				<p:autoUpdate></p:autoUpdate>
			</p:messages>

			<p:dataTable value="#{cotacaoController.cotacoesAuxiliares}"
				var="cotacao" selection="#{cotacaoController.cotacoesSelected}"
				style="margin-bottom:0" rowKey="#{cotacao.fornecedorId}">

				<p:column selectionMode="multiple"
					style="width:36px;text-align:center" />

				<p:column headerText="Fornecedor">
					<h:outputText value="#{cotacao.fornecedor}" />
				</p:column>

				<p:column style="width:100px" headerText="Valor">
					<h:outputText value="#{cotacao.totalValor}">
						<f:convertNumber type="currency" maxFractionDigits="2"
							currencySymbol="R$" />
					</h:outputText>
				</p:column>

				<p:column style="width:100px" headerText="Valor c/ desconto">
					<h:outputText value="#{cotacao.totalDesconto}">
						<f:convertNumber type="currency" maxFractionDigits="2"
							currencySymbol="R$" />
					</h:outputText>
				</p:column>

				<p:column style="width:100px">

					<p:link styleClass="btn btn-primary btn-sm" title="Editar"
						outcome="/main/cotacaoCadastro">
						<f:param name="forn" value="#{cotacao.fornecedorId}" />
						<f:param name="comp" value="#{cotacaoController.compra.id}" />

						<span class="pi pi-pencil"></span>
					</p:link>

					<p:commandLink title="Excluir" styleClass="btn btn-danger btn-sm"
						action="#{cotacaoController.excluirCotacao(cotacao.compraId,cotacao.fornecedorId)}"
						process="@this" update="form-cotacao message_cotacao">
						<span class="pi pi-times-circle"></span>
						<p:confirm header="Exclusão"
							message="Você deseja excluir a cotação?"
							icon="pi pi-exclamation-triangle" />
					</p:commandLink>
				</p:column>

			</p:dataTable>

			<div class="fixed-btn">

				<p:panel id="btn-panel-p">

					<div id="btn-panel-wizard" class="ui-g ui-fluid"
						style="margin-bottom: 10px">

						<div class="ui-g-12">

							<p:link styleClass="btn btn-success"
								rendered="#{cotacaoController.verificarAcessoACotacao()}"
								outcome="/main/cotacaoCadastro" style="margin: 2px 2px;"
								value="Novo">
								<f:param name="comp" value="#{cotacaoController.compra.id}" />

							</p:link>

							<p:commandLink styleClass="btn btn-primary"
								action="#{cotacaoController.prepararEmail()}"
								update=":form-email"
								onclick="setarWidth();PF('email_dlg').show();"
								value="Enviar e-mail" style="margin-left:2px">
								<p:resetInput target=":form-email :form-email:msg-email" />

								<p:link title="Voltar" value="Voltar" style="margin: 2px 2px;"
									styleClass="btn btn-secondary" outcome="/main/compra_new">
								</p:link>

								<p:commandLink styleClass="btn btn-secondary" rendered="true"
									target="_blank"
									action="#{cotacaoController.imprimirMapaComparativo()}"
									ajax="false" style="margin: 2px 2px;float:right"
									value="Mapa comparativo" />

								<p:commandLink styleClass="btn btn-secondary" target="_blank"
									action="#{cotacaoController.imprimirFormulario()}" ajax="false"
									style="margin: 2px 2px;float:right"
									value="Formulário de cotação" />
							</p:commandLink>

						</div>

					</div>

				</p:panel>

			</div>

			<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
				<p:commandButton value="Sim" type="button"
					styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
				<p:commandButton value="Não" type="button"
					styleClass="ui-confirmdialog-no" icon="pi pi-times" />
			</p:confirmDialog>

		</h:form>


	</ui:define>

	<ui:define name="adicionais">

		<script type="text/javascript">
	function setarWidth() {
		var htmlTag = document.getElementById('scroll-email');
		htmlTag.style.height = Math.floor(window.innerHeight*0.9)+"px";	
		htmlTag.style.width = Math.floor(window.innerWidth*0.98)+"px";	
	}
</script>

		<style type="text/css">
.ui-datalist {
	margin-bottom: 20px;
}

.ui-datalist-item {
	padding: 3px;
	margin-left: 20px;
}

.paginated .ui-datalist-data {
	padding-left: 20px;
}

body .ui-fileupload .ui-fileupload-content {
	display: none !important;
}
</style>


		<p:dialog header="E-mail: comprasgi@fas-amazonas.org"
			closeOnEscape="true" closable="true" minimizable="true"
			maximizable="true" widgetVar="email_dlg" modal="false"
			showEffect="clip" style="width:100%; height:100%" hideEffect="clip">

			<p:scrollPanel id="scroll-email" mode="native">

				<div>
					<h:form id="form-email" prependId="false">

						<div class="ui-g ui-fluid" style="position: relative">

							<div class="ui-g-12">

								<p:messages id="msg-email" showDetail="true" showSummary="false"
									closable="true">
									<p:autoUpdate></p:autoUpdate>
								</p:messages>

							</div>

							<div class="ui-g-12 form-group">

								<p:outputLabel value="Para:" for="to-email" />
								<p:inputText id="to-email" disabled="true"
									value="#{cotacaoController.email.toEmail}" />

							</div>

							<div class="ui-g-12 form-group">

								<p:outputLabel value="Assunto:" for="subject-email"></p:outputLabel>
								<p:inputText id="subject-email"
									value="#{cotacaoController.email.subject}"></p:inputText>

							</div>

							<div class="ui-g-12">
								<p:outputLabel value="Conteúdo:" for="content" />
								<p:inputText id="content"
									value="#{cotacaoController.email.content}" />
							</div>

							<div class="ui-g-12 form-group">
								<p:fileUpload label="Anexos" update="list-anexo"
									fileUploadListener="#{cotacaoController.handleFileUpload}"
									auto="true" sizeLimit="5000000"
									allowTypes="/(\.|\/)(doc|docx|xls|xlsx|pdf)$/">

									<p:dataList rowIndexVar="index" id="list-anexo"
										style="with:100%" value="#{cotacaoController.listAnexo}"
										var="path" type="ordered">

										<div class="ui-g ui-fluid">
											<div class="ui-g-6">#{path}</div>

											<div class="ui-g-6" style="text-align: right">
												<p:commandLink id="btn-remove-anexo" title="Excluir"
													rendered="true" update="list-anexo, btn-remove-anexo"
													styleClass="btn btn-primary" style="font-size:14px;float:right"
													action="#{cotacaoController.removerAnexoEmail(index)}">
													<span class="pi pi-times-circle"></span>
													<f:setPropertyActionListener value="#{path}"
														target="#{cotacaoController.pathAnexo}"></f:setPropertyActionListener>
												</p:commandLink>
											</div>
										</div>

									</p:dataList>
								</p:fileUpload>

							</div>

							<div class="ui-g-12">
								<p:commandLink update="form-email"
									styleClass="btn btn-primary btn-block" style="color:#fff"
									value="Enviar" onclick="start()" oncomplete="stop()"
									onerror="stop()"
									action="#{cotacaoController.enviarCotacaoEmail()}" />

							</div>

						</div>

					</h:form>

				</div>

			</p:scrollPanel>

		</p:dialog>

		<p:dialog modal="true" style="z-index:1000" widgetVar="statusDialog"
			showHeader="false" draggable="false" closable="false"
			resizable="false">
			<p:graphicImage library="image" name="aguarde.gif" />
			<p:graphicImage style="width:120px;height:70px" library="image"
				name="logofas.png" />
		</p:dialog>




	</ui:define>


</ui:composition>