<!DOCTYPE html>
<ui:composition template="/WEB-INF/LayoutFullPage.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:jsf="http://xmlns.jcp.org/jsf">




	<ui:define name="content">

		<script type="text/javascript">
			function start() {
				PF('statusDialog').show();
			}

			function stop() {
				PF('statusDialog').hide();
			}

			function stopDlgfilter() {
				PF('dlg_filtro_compra').hide();
			}
		</script>


		<h:form id="form-orcado-realizado">

			<f:metadata>
				<f:viewAction action="#{report_financ_controller.init()}" />
				<f:viewAction
					action="#{report_financ_controller.prepararFiltrosParaConferenciaDeLancamentos()}" />
			</f:metadata>

			<p:messages id="message" showSummary="false" style="margin-top:10px"
				showDetail="true" closable="true" showIcon="true">

				<p:autoUpdate />
			</p:messages>


			<p:breadCrumb class="breadcrumb-container">


				<p:menuitem style="margin-top: 0.5vh" value="Categories"
					url="home_new.xhtml" />
				<p:menuitem value="Relatórios" url="relatorios_fin.xhtml" />
				<p:menuitem value="Orçado x Realizado"
					url="orcado_realizadoMODE01.xhtml" />
			</p:breadCrumb>

			<p:panel style="margin-bottom:20px">

				<div class="ui-g ui-fluid default-style-form-filter" style="margin-top: 8px">
					<div class="ui-g-4 form-group focused">
						<p:outputLabel for="fonte" value="Fonte:" styleClass="form-label" />
						<p:selectCheckboxMenu id="fonte"
							value="#{report_financ_controller.filtro.fontes}" filter="true"
							filterMatchMode="startsWith" multiple="true">
							<f:selectItems value="#{report_financ_controller.fontes}"
								var="fonte" itemLabel="#{fonte.nome}" itemValue="#{fonte.id}" />

							<p:ajax update="doacoes"
								listener="#{report_financ_controller.atualizarDoacoes()}" />

							<p:ajax event="toggleSelect" update="doacoes"
								listener="#{report_financ_controller.atualizarDoacoes()}" />
						</p:selectCheckboxMenu>
					</div>

					<div class="ui-g-4 form-group focused">
						<p:outputLabel for="doacoes" value="Doação:"
							styleClass="form-label" />

						<p:selectCheckboxMenu id="doacoes" panelStyle="width:350px"
							value="#{report_financ_controller.filtro.idDoacao}"
							multiple="true" label="Doações" filter="true"
							filterMatchMode="contains">
							<f:selectItem itemValue="0" noSelectionOption="true"
								itemLabel="Doação" />
							<f:selectItems value="#{report_financ_controller.orcamentos}"
								var="orc" itemLabel="#{orc.titulo}" itemValue="#{orc.id}" />
							<p:ajax update="projeto"
								listener="#{report_financ_controller.carregarProjetos()}" />

						</p:selectCheckboxMenu>
					</div>

					<div class="ui-g-4 form-group focused">
						<p:outputLabel value="Projeto" styleClass="form-label" />
						<p:selectCheckboxMenu id="projeto" panelStyle="width:350px"
							required="true" multiple="true"
							requiredMessage="Escolha um projeto ou mais para gerar o relatório"
							value="#{report_financ_controller.filtro.projetos}"
							label="Projetos" filter="true" filterMatchMode="contains">
							<f:selectItems value="#{report_financ_controller.projetos}"
								var="projeto" itemLabel="#{projeto.codigo} - #{projeto.nome}"
								itemValue="#{projeto.id}">
							</f:selectItems>
						</p:selectCheckboxMenu>

					</div>


					<div class="ui-g-4 form-group focused">
						<p:outputLabel for="gestao"
							value="#{message['FILTER_MANAGEMENT']}" styleClass="form-label" />
						<p:autoComplete id="gestao" scrollHeight="250"
							converter="gestaoConverter"
							value="#{report_financ_controller.filtro.gestao}"
							completeMethod="#{report_financ_controller.findGestaoAutoComplete}"
							var="ges" itemLabel="#{ges.nome}" itemValue="#{ges}"
							effect="blind" />
					</div>

					<div class="ui-g-4 form-group focused">

						<p:outputLabel for="filter-dt-inicio" value="Data incial:"
							styleClass="form-label" />
						<p:calendar id="filter-dt-inicio"
							value="#{report_financ_controller.filtro.dataInicio}"
							navigator="true" pattern="dd/MM/yyyy" />

					</div>

					<div class="ui-g-4 form-group focused">

						<p:outputLabel for="filter-dt-final" value="Data final:"
							styleClass="form-label" />
						<p:calendar id="filter-dt-final"
							value="#{report_financ_controller.filtro.dataFinal}"
							navigator="true" pattern="dd/MM/yyyy" />

					</div>

					<div class="ui-g-4 form-group focused">
						<p:outputLabel for="tipo" value="Tipo de Relatório"
							styleClass="form-label" />
						<p:selectOneMenu id="tipo" styleClass="mt-1"
							value="#{report_financ_controller.filtro.tipoRelatorio}">
							<f:selectItem itemLabel="Padrão" itemValue="PADRAO" />
							<f:selectItem itemLabel="Consolidado" itemValue="CONSOLIDADO" />
							<f:selectItem itemLabel="Linha Orçamentária" itemValue="LINHA" />
						</p:selectOneMenu>
					</div>

					<div class="ui-g-12 d-flex justify-content-end">
						<p:commandLink styleClass="btn btn-success btn-sm" ajax="false"
							action="#{report_financ_controller.gerarOrcamentoExecutado()}"
							onclick="start()" onsuccess="stop()" onerror="stop()"
							style="color:#fff; margin: 8px 2px;">
							<span class="fa fa-file-excel-o"
								style="font-size: 20px; padding-right: 5px" aria-hidden="true"></span>
							<span>Gerar relatório XLS</span>
						</p:commandLink>

						<p:commandLink rendered="false"
							styleClass="btn btn-primary btn-sm fa fa-search"
							onstart="start()" onsuccess="stop()" onerror="stop()"
							update="tbl_exec_financeira"
							action="#{report_financ_controller.filtrarByProject()}"
							style="color:#fff; margin: 8px 2px;">
							<span style="width: 40px; font-family: Arial">Visualizar
								Execução</span>

						</p:commandLink>

						<p:commandLink styleClass="btn btn-danger btn-sm"
							action="#{compraDetalhadaController.limparFiltro()}"
							process="@this" update="form-orcado-realizado"
							style="color:#fff; margin: 8px 2px;">
							<span class="fa fa-fw fa-trash-o"></span>
							<span>Limpar filtro</span>

						</p:commandLink>
					</div>

					<p:dataTable id="tbl_exec_financeira" rendered="true"
						sortBy="#{lancamento.nomeProjeto}" expandableRowGroups="true"
						value="#{report_financ_controller.lancamentos}" var="lancamento">

						<f:facet name="header">
 
 	 			Execução
       				 						</f:facet>

						<p:headerRow>
							<p:column colspan="8">
								<h:outputText style="padding:8px;font-size:11px"
									value="#{lancamento.nomeProjeto}" />
							</p:column>
						</p:headerRow>


						<p:column headerText="Dt. de Pagamento" style="width:6%">
							<h:outputText value="#{lancamento.dataPagamento}">
								<f:convertDateTime pattern="dd/MM/yyyy"
									timeZone="America/Manaus" />
							</h:outputText>
						</p:column>

						<p:column headerText="Dt. de Emissão" style="width:6%">
							<h:outputText value="#{lancamento.dataEmissao}">
								<f:convertDateTime pattern="dd/MM/yyyy"
									timeZone="America/Manaus" />
							</h:outputText>
						</p:column>

						<p:column headerText="Nº de documento" style="width:6%">
							<h:outputText value="#{lancamento.numeroDocumento}" />
						</p:column>

						<p:column headerText="Nº de lançamento" style="width:6%">
							<h:outputText value="#{lancamento.id}" />
						</p:column>

						<p:column headerText="Nota fiscal">
							<h:outputText value="#{lancamento.notaFiscal}" />
						</p:column>

						<p:column headerText="Pagador">
							<h:outputText value="#{lancamento.contaPagadorLbl}" />
						</p:column>

						<p:column headerText="Recebedor" style="width:6%">
							<h:outputText value="#{lancamento.contaRecebedorLbl}" />
						</p:column>

						<p:column headerText="Descrição">
							<h:outputText value="#{lancamento.descricao}" />
						</p:column>

						<p:column headerText="Projeto">
							<h:outputText value="#{lancamento.nomeProjeto}" />
						</p:column>
						<p:column headerText="Fonte">
							<h:outputText value="#{lancamento.fonte}" />
						</p:column>

						<p:column headerText="Status" style="text-align:center">
							<h:outputText value="P"
								rendered="#{lancamento.status.equals('PROVISIONADO')}" />
							<h:outputText value="E"
								rendered="#{lancamento.status.equals('EFETIVADO')}" />
						</p:column>

						<p:column headerText="Entrada">
							<h:outputText value="#{lancamento.entrada}">
								<f:convertNumber type="currency" maxFractionDigits="2"
									currencySymbol="R$" />
							</h:outputText>
						</p:column>

						<p:column headerText="Saída">
							<h:outputText value="#{lancamento.saida}">
								<f:convertNumber type="currency" maxFractionDigits="2"
									currencySymbol="R$" />
							</h:outputText>
						</p:column>
					</p:dataTable>

				</div>

			</p:panel>

		</h:form>
	</ui:define>

	<ui:define name="adicionais">

		<p:dialog modal="true" style="z-index:1000" widgetVar="statusDialog"
			showHeader="false" draggable="false" closable="false"
			resizable="false">
			<p:graphicImage library="image" name="aguarde.gif" />
			<p:graphicImage style="width:120px;height:70px" library="image"
				name="logofas.png" />
		</p:dialog>

	</ui:define>


</ui:composition>