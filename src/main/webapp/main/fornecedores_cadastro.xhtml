

<!DOCTYPE html>
<ui:composition template="/WEB-INF/Layout.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:jsf="http://xmlns.jcp.org/jsf" xmlns:o="http://omnifaces.org/ui">


	<ui:define name="menu_lateral">

		<script type="text/javascript">
			function start() {
			    PF('statusDialog').show();
			}
			 
			function stop() {
			    PF('statusDialog').hide();
			}
		</script>
		
		
		<style type="text/css">
		 
		 .ui-widget-header {
    border: 1px solid #eeeeee;
    background: #849a39;
    color: #ffffff;
    font-weight: normal;
}
		
		</style>



		<f:metadata>
			<o:viewParam name="forn" value="#{fornecedor_controller.fornecedor}" />
			<f:viewAction
				action="#{fornecedor_controller.carregarUltimoFornecimento()}" />
		</f:metadata>

		<h:form id="tabela_menu">


			<p:dialog widgetVar="statusDialog" modal="true" draggable="false"
				closable="false" resizable="false" showHeader="false"
				style="background-color:#FFFFFF; z-index:1009">
				<p:graphicImage library="image" name="aguarde.gif" />
			</p:dialog>

			<p:dataTable id="tab-menu" scrollable="true" emptyMessage="..."
				scrollHeight="300" styleClass="table table-hover"
				value="#{fornecedor_controller.menus}" var="menu">

				<p:column>
					<p:commandLink action="#{fornecedor_controller.redirecionar()}"
						style="font-size:1em;" value="#{menu.nome}">
						<f:setPropertyActionListener value="#{menu}"
							target="#{fornecedor_controller.menu}" />
					</p:commandLink>
					<span style="margin-left: 4px; float: right;" class="#{menu.icon}"></span>
				</p:column>

			</p:dataTable>
		</h:form>

	</ui:define>
	<ui:define name="content">
		<h:form id="formFornecedor" acceptcharset="ISO-8859-1"
			enctype="multipart/form-data">
			<p:tabView id="cadastroFornecedor" prependId="false">
				<p:tab title="Cadastro de Fornecedores">
					<p:messages id="msgs"  showSummary="false"
						showDetail="true" showIcon="true" closable="true" />



					<p:panel id="PanelCadastro">

						<div class="botao_central" align="left" 
							style="width: 100%; background-color: rgba(51, 122, 183, 0.18);">

							<p:commandLink styleClass="btn btn-primary btn-sm" type="button"
								action="#{fornecedor_controller.insert()}" onclick="start()"
								oncomplete="stop()" onerror="stop()"
								style="color:#fff; margin: 2px 2px;" value="Salvar"
								process="PanelCadastro" >
								<p:confirm message="Confirma a inclusão/alteração do fornecedor?" />
							</p:commandLink>

							<p:commandLink
								action="#{fornecedor_controller.voltarTelaDeListagem()}"
								value="voltar" ajax="false" immediate="true"
								styleClass="btn btn-info btn-sm" />

							<p:confirmDialog global="true" showEffect="fade" hideEffect="fade">
								<p:commandButton value="Sim" type="button"
												 styleClass="ui-confirmdialog-yes" icon="ui-icon-check" />
								<p:commandButton value="Não" type="button"
												 styleClass="ui-confirmdialog-no" icon="ui-icon-close" />
							</p:confirmDialog>

						</div>

						<p:panelGrid columns="2" style="width:100%" layout="grid"
							columnClasses="ui-grid-col-2,ui-grid-col-10">


							<p:outputLabel value="Tipo: " />

							<p:selectOneRadio id="tipo"
								disabled="#{fornecedor_controller.fornecedor.id != null}"
								value="#{fornecedor_controller.fornecedor.tipo}"
								styleClass="form-control" required="true"
								requiredMessage="Tipo é obrigatório">
								<f:selectItem itemLabel="PESSOA JURIDICA" itemValue="juridica" />
								<f:selectItem itemLabel="PESSOA FISICA" itemValue="fisica" />
								<p:ajax update="PanelCadastro formFornecedor" resetValues="true" />

							</p:selectOneRadio>

							<p:outputLabel value="CNPJ:"
								rendered="#{fornecedor_controller.fornecedor.tipo.equals('juridica')}" />

							<p:inputMask mask="99.999.999/9999-99" onblur="verificarCNPJ(this);"
								size="30" value="#{fornecedor_controller.fornecedor.cnpj}"
								disabled="#{fornecedor_controller.fornecedor.id != null}"
								required="true" title="Dígite o CNPJ"
								rendered="#{fornecedor_controller.fornecedor.tipo.equals('juridica')}"
								requiredMessage="CNPJ é obrigatório"
								styleClass="#{fornecedor_controller.fornecedor.tipo.equals('juridica') ? 'field_border_red' : null}" />


							<p:outputLabel value="CPF: "
								rendered="#{fornecedor_controller.fornecedor.tipo.equals('fisica')}" />

							<p:inputMask mask="999.999.999-99" size="30" onblur="validarCPF(this);"
								value="#{fornecedor_controller.fornecedor.cpf}"
								title="Dígite o CPF" required="true"
								disabled="#{fornecedor_controller.fornecedor.id != null}"
								rendered="#{fornecedor_controller.fornecedor.tipo.equals('fisica')}"
								requiredMessage="CPF é obrigatório"
								styleClass="#{fornecedor_controller.fornecedor.tipo.equals('fisica') ? 'field_border_red' : null}" />


							<p:outputLabel value="INSC. EST.: " />
							<p:inputText
								value="#{fornecedor_controller.fornecedor.inscricaoEstadual}"
								onkeypress="return somenteNumeros(event);" maxlength="10" size="30" />

							<p:outputLabel value="Nome: " />

							<h:panelGroup>
								<p:inputText maxlength="85"
									value="#{fornecedor_controller.fornecedor.razaoSocial}"
									style="width:300px; text-transform: uppercase"
									requiredMessage="Nome é obrigatório"
									disabled="#{fornecedor_controller.fornecedor.id != null}"
									required="#{fornecedor_controller.verificarObrigatoriedade('nome')}"
									styleClass="#{fornecedor_controller.verificarObrigatoriedade('nome') ? 'field_border_red' : null}"/>

								<p:outputLabel value="1º TEL/CEL:"
									style="margin-left:5px;margin-right:5px" />
								<p:inputMask mask="(99) 99999-9999" 
									required="#{fornecedor_controller.verificarObrigatoriedade('telefone')}"
									value="#{fornecedor_controller.fornecedor.telefone}"
									requiredMessage="TEL/CEL é obrigatório"
									styleClass="#{fornecedor_controller.verificarObrigatoriedade('telefone') ? 'field_border_red' : null}" />

							</h:panelGroup>

							<p:outputLabel value="Nome Fantasia: " />

							<h:panelGroup>
								<p:inputText maxlength="85"
									value="#{fornecedor_controller.fornecedor.nomeFantasia}"
									style="width:300px; text-transform: uppercase"
									requiredMessage="Nome fantasia é obrigatório"
									required="#{fornecedor_controller.verificarObrigatoriedade('nome_fantasia')}"
									styleClass="#{fornecedor_controller.verificarObrigatoriedade('nome_fantasia') ? 'field_border_red' : null}" />

								<p:outputLabel value="2º TEL/CEL:"
									style="margin-left:5px;margin-right:5px" />
								<p:inputMask mask="(99) 99999-9999" 
									value="#{fornecedor_controller.fornecedor.telefoneSecundario}" />

							</h:panelGroup>

							<p:outputLabel value="Endereço: " />
							<h:panelGroup>
								<p:inputText maxlength="120"
									value="#{fornecedor_controller.fornecedor.endereco}"
									style="width:300px; text-transform: uppercase"
									requiredMessage="Endereço é obrigatório"
									required="#{fornecedor_controller.verificarObrigatoriedade('endereco')}"
									styleClass="#{fornecedor_controller.verificarObrigatoriedade('endereco') ? 'field_border_red' : null}" />

								<p:outputLabel value="Nº:"
									style="margin-left:5px;margin-right:5px" />

								<p:inputText value="#{fornecedor_controller.fornecedor.numero}"
									size="10" requiredMessage="Nº é obrigatório"
									maxlength="6"
									style="text-transform: uppercase"
									required="#{fornecedor_controller.verificarObrigatoriedade('numero')}"
									styleClass="#{fornecedor_controller.verificarObrigatoriedade('numero') ? 'field_border_red' : null}" />

							</h:panelGroup>

							<p:outputLabel value="Complemento: " />
							<p:inputText maxlength="85"
								value="#{fornecedor_controller.fornecedor.complemento}"
								style="width:300px; text-transform: uppercase">

							</p:inputText>

							<p:outputLabel value="CEP: " />

							<h:panelGroup>
								<p:inputMask mask="99.999-999" 
									value="#{fornecedor_controller.fornecedor.cep}"
									requiredMessage="CEP é obrigatório"
									required="#{fornecedor_controller.verificarObrigatoriedade('cep')}"
									styleClass="#{fornecedor_controller.verificarObrigatoriedade('cep') ? 'field_border_red' : null}" />

								<p:outputLabel value="Bairro: "
									style="margin-left:5px;margin-right:5px" />
								<p:inputText
								maxlength="85"
									styleClass="#{fornecedor_controller.verificarObrigatoriedade('bairro') ? 'field_border_red' : null} ; text-transform: uppercase"
									required="#{fornecedor_controller.verificarObrigatoriedade('bairro')}"
									requiredMessage="Bairro é obrigatório"
									value="#{fornecedor_controller.fornecedor.bairro}" size="40"
									style="text-transform: uppercase" />

							</h:panelGroup>


							<p:outputLabel value="Pessoal de contato: " />
							<p:inputText value="#{fornecedor_controller.fornecedor.contato}"
								style="width:300px;text-transform: uppercase">
							</p:inputText>

							<p:outputLabel value="Data Nasc.: " rendered="#{fornecedor_controller.verificarObrigatoriedade('data_nasc')}"/>
							<p:inputMask id="date"
										 value="#{fornecedor_controller.fornecedor.dataNascimento}"
										 mask="99/99/9999"
										 styleClass="#{fornecedor_controller.verificarObrigatoriedade('data_nasc') ? 'field_border_red' : null}"
										 required="#{fornecedor_controller.verificarObrigatoriedade('data_nasc')}"
										 rendered="#{fornecedor_controller.verificarObrigatoriedade('data_nasc')}"
										 requiredMessage="Data Nasc. é obrigatório">
								<f:convertDateTime pattern="dd/MM/yyyy"
												   timeZone="America/Fortaleza" />
							</p:inputMask>

							<p:outputLabel value="PIS.:" />
							<p:inputMask mask="99999999999" value="#{fornecedor_controller.fornecedor.pis}"
										 styleClass="#{fornecedor_controller.verificarObrigatoriedade('pis') ? 'field_border_red' : null}"
										 required="#{fornecedor_controller.verificarObrigatoriedade('pis')}"
										 requiredMessage="PIS é obrigatório" />

							<p:outputLabel value="Estado: " />

							<h:panelGroup>
								<p:selectOneMenu id="est" filter="true"
									styleClass="#{fornecedor_controller.verificarObrigatoriedade('cidade') ? 'field_border_red' : null}"
									value="#{fornecedor_controller.fornecedor.estado}"
									requiredMessage="Estado é obrigatório"
									converter="estadoConverter"
									required="#{fornecedor_controller.verificarObrigatoriedade('cidade')}">
									<f:selectItem noSelectionOption="true" />
									<f:selectItems value="#{fornecedor_controller.estados}"
										var="est" itemValue="#{est}" itemLabel="#{est.nome}">

									</f:selectItems>

									<p:ajax listener="#{fornecedor_controller.carregarCidades()}"
										process="@this" update="cidade2" />
								</p:selectOneMenu>

								<p:outputLabel value="Cidade:"
									style="margin-left:5px;margin-right:5px" />


								<p:selectOneMenu id="cidade2" filter="true"
								 	styleClass="#{fornecedor_controller.verificarObrigatoriedade('cidade') ? 'field_border_red' : null}"
									value="#{fornecedor_controller.fornecedor.cidade}"
									required="#{fornecedor_controller.verificarObrigatoriedade('cidade')}"
									requiredMessage="Cidade é obrigatório" converter="localConverter">
									<f:selectItem noSelectionOption="true" />
									<f:selectItems value="#{fornecedor_controller.listaLocalidade}"
										converter="localConverter" var="cid"
										itemLabel="#{cid.mascara}" itemValue="#{cid}"></f:selectItems>
								</p:selectOneMenu>
							</h:panelGroup>

							<p:outputLabel value="Email Pessoal: " />
							<p:inputText value="#{fornecedor_controller.fornecedor.email}"
								placeholder="exemplo@fas-amazonas.org" onblur="validacaoEmail(this);"
								style="width:300px;text-transform: uppercase"></p:inputText>

							<p:outputLabel value="Email Opcional: " />
							<p:inputText
								value="#{fornecedor_controller.fornecedor.emailSecundario}"
								placeholder="exemplo@fas-amazonas.org"  onblur="validacaoEmail(this);"
								style="width:300px;text-transform: uppercase">

							</p:inputText>

							<p:outputLabel value="Ativo:" />
							<p:inputSwitch value="#{fornecedor_controller.fornecedor.ativo}"
								offLabel="Inativo" onLabel="Ativo">
							</p:inputSwitch>

							<p:outputLabel value="Último fornecimento:"
								rendered="#{fornecedor_controller.existeFornecimento}" />
							<h:panelGroup
								rendered="#{fornecedor_controller.existeFornecimento}">
								<h:outputText value="lançamento:" style="margin-left:5px" />
								<h:outputText value="#{fornecedor_controller.lancamento.id}" />

								<h:outputText value="Data:" style="margin-left:5px" />
								<h:outputText
									value="#{fornecedor_controller.lancamento.dataEmissaoString}" />
							</h:panelGroup>

							<p:outputLabel value="Tipo de pagamentos: " />
							<p:selectOneRadio id="tipo_pagamento" required="true"
								requiredMessage="Tipo de pagamento é obribatório"
								value="#{fornecedor_controller.fornecedor.tipoPagamento}"
								styleClass="form-control">
								<f:selectItem itemLabel="Depósito em conta"
									itemValue="DEP_CONTA" />
								<f:selectItem itemLabel="Boleto bancário" itemValue="BOLETO" />

							</p:selectOneRadio>

							<h:outputLabel value="Categorias de Fornecimento:" />
							<h:outputLabel value="" />

							<h:outputLabel value="1º:" />
							<p:selectOneMenu id="input_categoria1"
								value="#{fornecedor_controller.fornecedor.categoriaFornecedor1}"
								filter="true" filterMatchMode="contains"
								converter="categoriaConverter">
								<f:selectItem itemLabel="Selecione uma categoria"
									itemValue="#{fornecedor_controller.categoriaZERO}" />
								<f:selectItems value="#{fornecedor_controller.categorias}"
									var="cat" itemValue="#{cat}" itemLabel="#{cat.nome}" />
							</p:selectOneMenu>


						</p:panelGrid>


					</p:panel>
					<p:separator></p:separator>

					<p:panel id="panelConta">
						<f:facet name="header">
							<p:outputLabel value="Contas bancárias"></p:outputLabel>
						</f:facet>

						<p:messages id="msgConta"  showSummary="false"
									showDetail="true" showIcon="true" closable="true" />

						<p:panelGrid columns="10">
							<p:outputLabel value="Banco: " />

							<p:autoComplete id="banco_conta" required="true"
								placeholder="Banco" inputStyle="width:155px"
								requiredMessage="Banco é obrigatório"
								value="#{fornecedor_controller.contaBancaria.banco}"
								completeMethod="#{fornecedor_controller.completeBanco}"
								var="banc" itemLabel="#{banc.nomeBanco}" itemValue="#{banc}"
								forceSelection="true">

								<p:column>
									<h:outputText value="#{banc.numeroBanco}" />
								</p:column>

								<p:column>
									<h:outputText value="#{banc.nomeBanco}" />
								</p:column>

							</p:autoComplete>


							<p:outputLabel value="Agência: " />

							<p:inputMask mask="9999" required="true"
								requiredMessage="Agência é obrigatório"
								value="#{fornecedor_controller.contaBancaria.numeroAgencia}" />

							<p:outputLabel value="-" />

							<p:inputText required="true"
										 requiredMessage="Digito da agência é obrigatório"
										 value="#{fornecedor_controller.contaBancaria.digitoAgencia}"
											style="width: 25px;text-transform: uppercase" maxlength="2"/>

							<p:outputLabel value="Conta: " />

							<p:inputMask mask="99999?999999" required="true"
								requiredMessage="Conta é obrigatório é obrigatório"
								value="#{fornecedor_controller.contaBancaria.numeroConta}" />


							<p:outputLabel value="-" />

							<p:inputText required="true"
										 requiredMessage="Digito da conta é obrigatório"
										 value="#{fornecedor_controller.contaBancaria.digitoConta}"
										 style="width: 25px;text-transform: uppercase" maxlength="1"/>

							<p:outputLabel value="Classificação" />
							<p:selectOneMenu
								value="#{fornecedor_controller.contaBancaria.classificacaoConta}">
								<f:selectItem itemLabel="Principal" itemValue="PRINCIPAL" />
								<f:selectItem itemLabel="Secundária" itemValue="SECUNDARIA" />
							</p:selectOneMenu>

							<p:commandButton title="Adicionar" value="Adicionar"
								process="panelConta" icon="fa fa-save" update="@parent contas msgConta"
								onclick="start()" oncomplete="stop()" onerror="stop()"
								style="font-size:10px;"
								action="#{fornecedor_controller.salvarConta}" />
						</p:panelGrid>

						<p:dataTable id="contas" rowIndexVar="index"
							paginatorTemplate="{CurrentPageReport}  {FirstPageLink} {PreviousPageLink} {PageLinks} {NextPageLink} {LastPageLink} {Exporters}"
							value="#{fornecedor_controller.fornecedor.contasBancarias}"
							tableStyle="table-layout: auto;" var="bean" paginator="true"
							widgetVar="filteredFornecedor" rows="50">

							<p:column filterStyle="display:none" headerText="Banco">
								<p:outputLabel value="#{bean.banco.nomeBanco}" />
							</p:column>

							<p:column filterStyle="display:none" headerText="Agência">
								<p:outputLabel value="#{bean.agencia}" />
							</p:column>

							<p:column filterStyle="display:none" headerText="Conta">
								<p:outputLabel value="#{bean.conta}" />
							</p:column>


							<p:column filterStyle="display:none" headerText="Classificação">
								<p:outputLabel value="#{bean.classificacaoConta}" />
							</p:column>




							<p:column style="width:120px;text-align:center" headerText="Ação"
								exportable="false">

								<p:commandButton title="Editar" icon="fa fa-edit"
									update=":formFornecedor:cadastroFornecedor:panelConta"
									process="@this"
									action="#{fornecedor_controller.editarConta(index)}">
									<f:setPropertyActionListener
										target="#{fornecedor_controller.contaBancaria}"
										value="#{bean}" />
								</p:commandButton>
								<p:spacer />

								<p:commandButton title="Excluir" icon="fa fa-remove"
									rendered="true" update="contas" process="@this"
									action="#{fornecedor_controller.removerConta(bean)}" />
							</p:column>

						</p:dataTable>

					</p:panel>


					<p:separator></p:separator>

					<p:panel id="panelArquivo">

						<f:facet name="header">
							<p:outputLabel value="Documentos"></p:outputLabel>
						</f:facet>

						<p:messages id="msg_aprouve"  showIcon="true"
							showSummary="false" showDetail="true" closable="true" />
						<p:panelGrid columns="1">

							<p:remoteCommand name="salvar"
								action="#{fornecedor_controller.adicionarArquivo()}"
								process="panelArquivo" update="table-arquivo" />


							<p:fileUpload label="Procurar" cancelLabel="Cancelar"
								uploadLabel="Anexar" oncomplete="salvar()"
								update="table-arquivo"
								fileUploadListener="#{fornecedor_controller.handleFileUpload}"
								mode="advanced" skinSimple="true" dragDropSupport="false"
								sizeLimit="100000000" allowTypes="/(\.|\/)(pdf)$/" />

							<p:dataTable id="table-arquivo" styleClass="ui-fluid"
								paginator="true" rows="4"
								value="#{fornecedor_controller.fornecedor.arquivos}" var="arq">
								
								<p:column headerText="Nome">
									<h:outputText value="#{arq.nome}" />
								</p:column>

								<p:column style="width:100px">

									<p:commandLink id="btn_visualizar" style="color:#000"
										styleClass="btn btn-default btn-xs glyphicon glyphicon-search"
										process="@this" onclick="PF('dialog_arquivo_f').show()">

										<f:setPropertyActionListener value="#{arq}"
											target="#{fornecedor_controller.arqAuxiliar}" />

									</p:commandLink>
									<p:tooltip for="btn_visualizar" value="Visualisar anexo"
										position="top" />


									<p:commandLink id="btn_excluir"
										style="color:#000;margin-left:9px" onclick="start()"
										onerror="stop()" oncomplete="stop()" process="@this"
										styleClass="btn btn-default btn-xs glyphicon glyphicon-remove-circle"
										action="#{fornecedor_controller.removerArquivo(arq)}"
										update="table-arquivo">
										<f:setPropertyActionListener value="#{arq}"
											target="#{fornecedor_controller.arqAuxiliar}" />
									</p:commandLink>

									<p:tooltip for="btn_excluir" value="Excluir anexo"
										position="top" />

								</p:column>

							</p:dataTable>

						</p:panelGrid>

					</p:panel>

				</p:tab>


			</p:tabView>
		</h:form>
	</ui:define>

	<ui:define name="adicionais">

		<p:dialog header="Anexos" modal="true" widgetVar="dialog_arquivo_f"
			hideEffect="clip" closeOnEscape="true" showEffect="clip">

			<h:form>
				<p:panel>

					<p:outputLabel value="Visualizar arquivo?"></p:outputLabel>

				</p:panel>

				<p:panelGrid columns="2" style="width:100%">
					<p:commandLink value="Sim" target="_blank" ajax="false"
						action="#{fornecedor_controller.visualizarArquivo()}" />
					<p:commandLink value="Não" onclick="PF('dialog_arquivo').hide();" />
				</p:panelGrid>

			</h:form>

		</p:dialog>

	</ui:define>

</ui:composition>