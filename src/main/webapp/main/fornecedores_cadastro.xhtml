<!DOCTYPE html>
<ui:composition template="/WEB-INF/LayoutFullPage.xhtml"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:jsf="http://xmlns.jcp.org/jsf" xmlns:o="http://omnifaces.org/ui">
	<ui:define name="content">
		<script type="text/javascript">
			function start() {
				PF("statusDialog").show();
			}

			function stop() {
				PF("statusDialog").hide();
			}
		</script>
		<div class="container">
			<h:form id="formFornecedor" styleClass="default-style-form-filter" acceptcharset="ISO-8859-1"
				enctype="multipart/form-data">
				<p:messages id="msgs" showSummary="false" showDetail="true"
					showIcon="true" closable="true" />
				<f:metadata>
					<o:viewParam name="forn"
						value="#{fornecedor_controller.fornecedor}" />
					<f:viewAction
						action="#{fornecedor_controller.carregarUltimoFornecimento()}" />
				</f:metadata>
				<p:panel header="Cadastro de Fornecedores" id="PanelCadastro"
					styleClass="mb-3">
					<div class="row mb-3">
						<div class="col">
							<p:commandLink styleClass="btn btn-success"
								action="#{fornecedor_controller.insert}" ajax="false"
								onclick="start()" onsuccess="stop()" onerror="stop()">
								<i class="fa fas fa-check"></i>
								<span>Salvar</span>
							</p:commandLink>

							<p:link outcome="/main/fornecedores" ajax="false"
								immediate="true" styleClass="btn btn-outline-dark">
								<i class="fa fa-fw fa-arrow-left"></i>
								<span>Voltar</span>
							</p:link>
						</div>
					</div>
					<div id="info-fornececdores" class="ui-g ui-fluid">
						<p:outputPanel styleClass="ui-g ui-fluid">
							<div class="ui-g-3 form-group" style="margin-bottom: 0;">
								<p:outputLabel value="Tipo de Cadastro:" for="tipo" />

								<p:selectOneRadio id="tipo" layout="grid" columns="1"
									disabled="#{fornecedor_controller.fornecedor.id != null}"
									value="#{fornecedor_controller.fornecedor.tipo}" required="true"
									requiredMessage="Tipo é obrigatório">
									<f:selectItem itemLabel="PESSOA JURÍDICA" itemValue="juridica" />
									<f:selectItem itemLabel="PESSOA FÍSICA" itemValue="fisica" />
									<p:ajax update="PanelCadastro formFornecedor" />
								</p:selectOneRadio>
							</div>
							<div class="ui-g-3 form-group">
								<p:outputPanel id="cad_forn_cnpj">
									<p:outputLabel value="CNPJ:" for="cnpj"
										rendered="#{fornecedor_controller.fornecedor.tipo.equals('juridica')}" />

									<p:inputMask mask="99.999.999/9999-99" id="cnpj"
										onblur="verificarCNPJ(this);" size="30"
										value="#{fornecedor_controller.fornecedor.cnpj}"
										disabled="#{fornecedor_controller.fornecedor.id != null}"
										required="true" title="Dígite o CNPJ"
										rendered="#{fornecedor_controller.fornecedor.tipo.equals('juridica')}"
										requiredMessage="CNPJ é obrigatório" styleClass="form-control">
									</p:inputMask>
								</p:outputPanel>

								<p:outputLabel value="CPF:" for="cpf"
									rendered="#{fornecedor_controller.fornecedor.tipo.equals('fisica')}" />

								<p:inputMask mask="999.999.999-99" size="30"
									onblur="verificarCPF(this);" id="cpf"
									value="#{fornecedor_controller.fornecedor.cpf}"
									title="Dígite o CPF" required="true"
									disabled="#{fornecedor_controller.fornecedor.id != null}"
									rendered="#{fornecedor_controller.fornecedor.tipo.equals('fisica')}"
									requiredMessage="CPF é obrigatório" styleClass="form-control" />
							</div>

							<p:outputPanel class="ui-g-3 form-group"
										   rendered="#{fornecedor_controller.fornecedor.tipo.equals('juridica')}">
								<p:outputLabel value="Nome Fantasia:" for="nome_fantasia" />

								<p:inputText maxlength="85" id="nome_fantasia"
											 value="#{fornecedor_controller.fornecedor.nomeFantasia}"
											 style="text-transform: uppercase"
											 requiredMessage="Nome fantasia é obrigatório"
											 required="#{fornecedor_controller.verificarObrigatoriedade('nome_fantasia')}"
											 styleClass="form-control" />
							</p:outputPanel>

							<div class="ui-g-3 form-group">
								<p:outputLabel value="Nome:" for="nome" />
								<p:inputText id="nome" maxlength="85"
									value="#{fornecedor_controller.fornecedor.razaoSocial}"
									style="text-transform: uppercase"
									requiredMessage="Nome é obrigatório"
									disabled="#{fornecedor_controller.fornecedor.id != null}"
									required="#{fornecedor_controller.verificarObrigatoriedade('nome')}"
									styleClass="form-control" />
							</div>

							<div class="ui-g-3 form-group">
								<p:outputLabel value="INSC. EST.:" for="insc_est" />
								<p:inputText id="insc_est"
											 value="#{fornecedor_controller.fornecedor.inscricaoEstadual}"
											 onkeypress="return somenteNumeros(event);" maxlength="10"
											 size="30" />
							</div>

							<div class="ui-g-3 form-group">
								<p:outputLabel value="1º TEL/CEL:" for="tel1" />
								<p:inputMask mask="(99) 99999-9999" id="tel1"
									required="#{fornecedor_controller.verificarObrigatoriedade('telefone')}"
									value="#{fornecedor_controller.fornecedor.telefone}"
									requiredMessage="TEL/CEL é obrigatório"
									styleClass="form-control" />
							</div>
							<div class="ui-g-3 form-group">
								<p:outputLabel value="2º TEL/CEL:" for="tel2" />
								<p:inputMask mask="(99) 99999-9999" id="tel2"
									value="#{fornecedor_controller.fornecedor.telefoneSecundario}"
									styleClass="form-control" />
							</div>

						</p:outputPanel>

						<p:separator style="border-bottom: 1px solid black;
											width: 100%; border-style: dashed;"/>

						<p:outputPanel id="form-address">
							<div class="ui-g ui-fluid">

								<div class="ui-g-3 form-group">
									<p:outputLabel value="CEP:" for="cep" />
									<p:inputMask mask="99.999-999" id="cep"
										value="#{fornecedor_controller.fornecedor.cep}"
										requiredMessage="CEP é obrigatório"
										required="#{fornecedor_controller.verificarObrigatoriedade('cep')}"
										styleClass="form-control">
										<p:ajax event="blur" listener="#{fornecedor_controller.autoCompleteAddress}"
												update="form-address"
												onstart="#{fornecedor_controller.fornecedor.cep.isEmpty() ? '' : 'start();'}"
												onsuccess="stop()"
												onerror="stop()"
										oncomplete="stop()"/>
									</p:inputMask>
								</div>
								<div class="ui-g-3 form-group">
									<p:outputLabel value="Endereço:" for="endereco" />
									<p:inputText maxlength="120" id="endereco"
										value="#{fornecedor_controller.fornecedor.endereco}"
										style="text-transform: uppercase"
										requiredMessage="Endereço é obrigatório"
										required="#{fornecedor_controller.verificarObrigatoriedade('endereco')}"
										styleClass="form-control" />
								</div>
								<div class="ui-g-3 form-group">
									<p:outputLabel value="Nº:" for="numero" />
									<p:inputText id="numero"
										value="#{fornecedor_controller.fornecedor.numero}" size="10"
										requiredMessage="Nº é obrigatório" maxlength="6"
										style="text-transform: uppercase"
										required="#{fornecedor_controller.verificarObrigatoriedade('numero')}"
										styleClass="form-control" />
								</div>
								<p:outputPanel class="ui-g-3 form-group" rendered="true">
									<p:outputLabel value="Complemento:" for="complemento"
												   style="width: 100px" />
									<p:inputText maxlength="85" id="complemento"
												 value="#{fornecedor_controller.fornecedor.complemento}"
												 style="text-transform: uppercase" />
								</p:outputPanel>
							</div>


							<div class="ui-g-3 form-group">
								<p:outputLabel value="Bairro:" for="bairro" />
								<p:inputText maxlength="85" styleClass="form-control" id="bairro"
									required="#{fornecedor_controller.verificarObrigatoriedade('bairro')}"
									requiredMessage="Bairro é obrigatório"
									value="#{fornecedor_controller.fornecedor.bairro}" size="40"
									style="text-transform: uppercase" />
							</div>

							<div class="ui-g-3 form-group">
								<p:outputLabel value="Pessoal de contato:" for="contato" />
								<p:inputText value="#{fornecedor_controller.fornecedor.contato}"
									id="contato" style="text-transform: uppercase">
								</p:inputText>
							</div>


							<div class="ui-g-3 form-group">
								<p:outputLabel value="Estado:" for="est" />
								<br />
								<p:selectOneMenu id="est" filter="true"
									value="#{fornecedor_controller.fornecedor.estado}"
									requiredMessage="Estado é obrigatório"
									converter="estadoConverter" style="width:100%"
									required="#{fornecedor_controller.verificarObrigatoriedade('cidade')}">
									<f:selectItem noSelectionOption="true" />
									<f:selectItems value="#{fornecedor_controller.estados}"
										var="est" itemValue="#{est}" itemLabel="#{est.nome}">
									</f:selectItems>

									<p:ajax listener="#{fornecedor_controller.carregarCidades()}"
										process="@this" update="cidade2" />
								</p:selectOneMenu>
							</div>

							<div class="ui-g-3 form-group">
								<p:outputLabel value="Cidade:" for="cidade2" />
								<br />
								<p:selectOneMenu id="cidade2" filter="true"
									value="#{fornecedor_controller.fornecedor.cidade}"
									required="#{fornecedor_controller.verificarObrigatoriedade('cidade')}"
									requiredMessage="Cidade é obrigatório" style="width:100%"
									converter="localConverter">
									<f:selectItem noSelectionOption="true" />
									<f:selectItems value="#{fornecedor_controller.listaLocalidade}"
										converter="localConverter" var="cid" itemLabel="#{cid.mascara}"
										itemValue="#{cid}"></f:selectItems>
								</p:selectOneMenu>
							</div>

							<div class="ui-g-3 form-group">
								<p:outputLabel value="Data Nasc.:" for="data_nasc"
									rendered="#{fornecedor_controller.verificarObrigatoriedade('data_nasc')}" />
								<p:inputMask id="data_nasc"
									value="#{fornecedor_controller.fornecedor.dataNascimento}"
									mask="99/99/9999" styleClass="form-control"
									required="#{fornecedor_controller.verificarObrigatoriedade('data_nasc')}"
									rendered="#{fornecedor_controller.verificarObrigatoriedade('data_nasc')}"
									requiredMessage="Data Nasc. é obrigatório">
									<f:convertDateTime pattern="dd/MM/yyyy"
										timeZone="America/Manaus" />
								</p:inputMask>
							</div>

							<div class="ui-g-3 form-group">
								<p:outputLabel value="PIS.:" for="pis" />
								<p:inputMask mask="99999999999" id="pis"
									value="#{fornecedor_controller.fornecedor.pis}"
									styleClass="form-control"
									required="#{fornecedor_controller.verificarObrigatoriedade('pis')}"
									requiredMessage="PIS é obrigatório" />
							</div>


							<div class="ui-g-3 form-group">
								<p:outputLabel value="Email Pessoal:" for="email1" />
								<p:inputText value="#{fornecedor_controller.fornecedor.email}"
									placeholder="exemplo@fas-amazonas.org" id="email1"
									onblur="validacaoEmail(this);" />
							</div>
							<div class="ui-g-3 form-group">
								<p:outputLabel value="Email Opcional:" for="email2" />
								<p:inputText id="email2"
									value="#{fornecedor_controller.fornecedor.emailSecundario}"
									placeholder="exemplo@fas-amazonas.org"
									onblur="validacaoEmail(this);" />
							</div>
							<div class="ui-g-3 form-group">
								<p:outputLabel value="Ativo:" for="ativo" />
								<br />
								<p:selectOneRadio id="ativo" value="#{fornecedor_controller.fornecedor.ativo}">
									<f:selectItem itemLabel="Sim" itemValue="true" />
									<f:selectItem itemLabel="Não" itemValue="false" />
								</p:selectOneRadio>
							</div>



							<div class="ui-g-3 form-group">
								<p:outputLabel value="Último fornecimento:"
									rendered="#{fornecedor_controller.existeFornecimento}" />
								<div class="row">
									<div class="ui-g-3 form-group">
										<h:outputText value="Lançamento:" />
									</div>
									<div class="ui-g-3 form-group">
										<h:outputText value="#{fornecedor_controller.lancamento.id}"
											style="font-weight:bold" />
									</div>
								</div>
								<div class="row">
									<div class="col">
										<h:outputText value="Data:" />
									</div>
									<div class="col">
										<h:outputText
											value="#{fornecedor_controller.lancamento.dataEmissaoString}"
											style="font-weight:bold" />
									</div>
								</div>
							</div>


							<div class="ui-g-3 form-group">
								<p:outputLabel value="Tipo de pagamentos:" for="tipo_pagamento" />
								<br />
								<p:selectOneRadio id="tipo_pagamento" required="true"
									requiredMessage="Tipo de pagamento é obribatório"
									value="#{fornecedor_controller.fornecedor.tipoPagamento}">
									<f:selectItem itemLabel="Depósito em conta"
										itemValue="DEP_CONTA" />
									<f:selectItem itemLabel="Boleto bancário" itemValue="BOLETO" />
								</p:selectOneRadio>
							</div>
							<div class="ui-g-3 form-group">
								<h:outputLabel value="Categorias de Fornecimento:"
									for="input_categoria1" />
								<br />
								<p:selectOneMenu id="input_categoria1"
									value="#{fornecedor_controller.fornecedor.categoriaFornecedor1}"
									filter="true" filterMatchMode="contains" style="width: 100%;"
									converter="categoriaConverter">
									<f:selectItem itemLabel="Selecione uma categoria"
										itemValue="#{fornecedor_controller.categoriaZERO}" />
									<f:selectItems value="#{fornecedor_controller.categorias}"
										var="cat" itemValue="#{cat}" itemLabel="#{cat.nome}" />
								</p:selectOneMenu>
							</div>
						</p:outputPanel>
					</div>
				</p:panel>

				<p:panel id="panelConta" header="Contas Bancárias" styleClass="mb-3">
					<p:messages id="msgConta" showSummary="false" showDetail="true"
						showIcon="true" closable="true" />

					<p:panelGrid columns="10">
						<p:outputLabel value="Banco: " />

						<p:autoComplete id="banco_conta" placeholder="Banco"
							inputStyle="width:155px"
							value="#{fornecedor_controller.contaBancaria.banco}"
							completeMethod="#{fornecedor_controller.completeBanco}"
							var="banc" itemLabel="#{banc.nomeBanco}" itemValue="#{banc}"
							forceSelection="true">
							<p:column>
								<h:outputText value="#{banc.numeroBanco}" />
							</p:column>

							<p:column>
								<h:outputText value="#{banc.nomeBanco}" />
							</p:column>
						</p:autoComplete>

						<p:outputLabel value="Agência: " />

						<p:inputMask mask="9999"
							value="#{fornecedor_controller.contaBancaria.numeroAgencia}" />

						<p:outputLabel value="-" />

						<p:inputText
							value="#{fornecedor_controller.contaBancaria.digitoAgencia}"
							style="width: 25px; text-transform: uppercase" maxlength="2" />

						<p:outputLabel value="Conta: " />

						<p:inputMask mask="99999?999999"
							value="#{fornecedor_controller.contaBancaria.numeroConta}" />

						<p:outputLabel value="-" />

						<p:inputText
							value="#{fornecedor_controller.contaBancaria.digitoConta}"
							style="width: 25px; text-transform: uppercase" maxlength="1" />

						<p:outputLabel value="Classificação" />
						<p:selectOneMenu
							value="#{fornecedor_controller.contaBancaria.classificacaoConta}">
							<f:selectItem itemLabel="Principal" itemValue="PRINCIPAL" />
							<f:selectItem itemLabel="Secundária" itemValue="SECUNDARIA" />
						</p:selectOneMenu>

						<p:commandLink process="panelConta"
							styleClass="btn btn-success btn-sm"
							update="@parent contas msgConta" onclick="start()"
							oncomplete="stop()" onerror="stop()"
							action="#{fornecedor_controller.salvarConta}">
							<i class="fa fas fa-save"></i>
							Salvar
							</p:commandLink>
					</p:panelGrid>

					<p:dataTable id="contas" rowIndexVar="index"
						value="#{fornecedor_controller.fornecedor.contasBancarias}"
						tableStyle="table-layout: auto;" var="bean"
						widgetVar="filteredFornecedor" rows="50">
						<p:column filterable="false" headerText="Banco">
							<p:outputLabel value="#{bean.banco.nomeBanco}" />
						</p:column>

						<p:column filterable="false" headerText="Agência">
							<p:outputLabel value="#{bean.agencia}" />
						</p:column>

						<p:column filterable="false" headerText="Conta">
							<p:outputLabel value="#{bean.conta}" />
						</p:column>

						<p:column filterable="false" headerText="Classificação">
							<p:outputLabel value="#{bean.classificacaoConta}" />
						</p:column>

						<p:column width="10%" headerText="Ação" exportable="false">
							<p:commandLink update="contas"
								styleClass="btn btn-primary btm-sm"
								action="#{fornecedor_controller.editarConta(index)}">
								<f:setPropertyActionListener
									target="#{fornecedor_controller.contaBancaria}" value="#{bean}" />
								<i class="fa fas fa-edit"></i>
							</p:commandLink>
							<p:commandLink rendered="true" update="contas" process="@this"
								styleClass="btn btn-danger btn-sm"
								action="#{fornecedor_controller.removerConta(bean)}">
								<i class="fa fa-trash"></i>
							</p:commandLink>
						</p:column>
					</p:dataTable>
				</p:panel>

				<p:panel id="panelArquivo" header="Documentos" styleClass="mb-3">
					<p:messages id="msg_aprouve" showIcon="true" showSummary="false"
						showDetail="true" closable="true" />

					<p:remoteCommand name="salvar"
						action="#{fornecedor_controller.adicionarArquivo}"
						process="panelArquivo" update="table-arquivo" />

					<p:fileUpload label="Procurar" cancelLabel="Cancelar"
						uploadLabel="Anexar" update="table-arquivo" oncomplete="salvar()"
						fileUploadListener="#{fornecedor_controller.handleFileUpload}"
						mode="advanced" skinSimple="true" dragDropSupport="false"
						sizeLimit="100000000" allowTypes="/(\.|\/)(pdf)$/" />

					<p:dataTable id="table-arquivo" styleClass="ui-fluid"
						paginator="true" rows="4"
						emptyMessage="Não há documentos anexados."
						value="#{fornecedor_controller.fornecedor.arquivos}" var="arq">
						<p:column headerText="Nome">
							<h:outputText value="#{arq.nome}" />
						</p:column>

						<p:column headerText="Ações" width="10%">

							<p:commandLink id="btn_visualizar"
								styleClass="btn btn-default btn-xs" process="@this"
								onclick="PF('dialog_arquivo_f').show()">
								<i class='fa fa-search'></i>
								<f:setPropertyActionListener value="#{arq}"
									target="#{fornecedor_controller.arqAuxiliar}" />
							</p:commandLink>
							<p:tooltip for="btn_visualizar" value="Visualizar anexo"
								position="top" />

							<p:commandLink id="btn_excluir" onclick="start()"
								onerror="stop()" oncomplete="stop()" process="@this"
								styleClass="btn btn-default btn-xs"
								action="#{fornecedor_controller.removerArquivo(arq)}"
								update="table-arquivo">
								<i class="fa fa-times-circle"></i>
								<f:setPropertyActionListener value="#{arq}"
									target="#{fornecedor_controller.arqAuxiliar}" />
							</p:commandLink>
							<p:tooltip for="btn_excluir" value="Excluir anexo" position="top" />

						</p:column>
					</p:dataTable>
				</p:panel>
			</h:form>
		</div>
	</ui:define>

	<ui:define name="adicionais">
		<p:dialog header="Anexos" modal="true" widgetVar="dialog_arquivo_f"
			hideEffect="clip" closeOnEscape="true" showEffect="clip">
			<h:form>
				<p:panel>
					<p:outputLabel value="Visualizar arquivo?"></p:outputLabel>
				</p:panel>

				<p:panelGrid columns="2" style="width: 100%">
					<p:commandLink value="Sim" target="_blank" ajax="false"
						action="#{fornecedor_controller.visualizarArquivo()}" />
					<p:commandLink value="Não" onclick="PF('dialog_arquivo').hide();" />
				</p:panelGrid>
			</h:form>
		</p:dialog>
		<p:dialog modal="true" style="z-index: 1000" widgetVar="statusDialog"
			showHeader="false" draggable="false" closable="false"
			resizable="false">
			<p:graphicImage library="image" name="aguarde.gif" />
			<p:graphicImage style="width: 120px; height: 70px" library="image"
				name="logofas.png" />
		</p:dialog>
	</ui:define>
</ui:composition>
