<!DOCTYPE html>
<ui:composition template="/WEB-INF/LayoutFullPage.xhtml"
				xmlns="http://www.w3.org/1999/xhtml"
				xmlns:f="http://xmlns.jcp.org/jsf/core"
				xmlns:h="http://xmlns.jcp.org/jsf/html"
				xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
				xmlns:p="http://primefaces.org/ui"
				xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
				xmlns:jsf="http://xmlns.jcp.org/jsf" xmlns:o="http://omnifaces.org/ui">






	<f:metadata>
		<o:viewParam name="viagem" value="#{sv_cadastro_controller.viagem}" />
		<f:viewAction action="#{sv_cadastro_controller.init()}" />
	</f:metadata>

	<ui:define name="content">

		<h:form acceptcharset="ISO-8859-1" id="form-cadastro-viagem">


			<script>
				function goBack() {
					window.history.back();
				}

				function start() {
					PF('statusDialog').show();
				}

				function stop() {
					PF('statusDialog').hide();
				}
			</script>


			<p:breadCrumb>
				<p:menuitem value="Categories" url="home_new.xhtml"
							onclick="start()" onsuccess="stop()" onerror="stop()" />
				<p:menuitem value="Solicitação de viagem - listagem"
							url="SolicitacaoViagem.xhtml" onclick="start()" onsuccess="stop()"
							onerror="stop()" />

				<p:menuitem value="Solicitação de viagem - cadastro" url="#" />
			</p:breadCrumb>

			<p:messages autoUpdate="true" showSummary="false" showDetail="true"
						closable="true" />

			<p:tabView id="tab_viagem" binding="#{sv_cadastro_controller.tabview}">

				<p:ajax event="tabChange" onstart="start()" onsuccess="stop()"
						onerror="stop()" listener="#{sv_cadastro_controller.definirTab()}"
						update=":form-cadastro-viagem:tab_viagem" />

				<p:tab title="Informações gerais">
					<ui:include src="/WEB-INF/sv01_.xhtml" />
				</p:tab>

				<p:tab title="Diárias" rendered="#{sv_cadastro_controller.showTabs}">
					<ui:include src="/WEB-INF/sv02.xhtml" />
				</p:tab>

				<p:tab title="Programação"
					   rendered="#{sv_cadastro_controller.showTabs}">
					<ui:include src="/WEB-INF/sv03.xhtml" />
				</p:tab>

				<p:tab title="Despesas"
					   rendered="#{sv_cadastro_controller.showTabs}">
					<ui:include src="/WEB-INF/sv04.xhtml" />
				</p:tab>

			</p:tabView>

		</h:form>

	</ui:define>

	<ui:define name="adicionais">


		<p:dialog widgetVar="dlg_impressao" modal="true" closable="true"
				  showHeader="false" showEffect="clip" hideEffect="clip">
			<h:form id="form-dialog">
				<p:panelGrid>
					<p:row>
						<p:column colspan="2">
							<div align="center" style="padding: 20px">
								<h:outputText value="Gerar diária?" />
							</div>
						</p:column>
					</p:row>

					<p:row>
						<p:column>
							<p:commandLink value="Sim"
										   styleClass="btn btn-default btn-success btn-sm btn-block"
										   oncomplete="PF('dlg_impressao').hide();" style="color:#fff"
										   action="#{sv_cadastro_controller.geraRelatorioDiaria()}"
										   ajax="false" process="@this" target="_blank"></p:commandLink>
						</p:column>

						<p:column>
							<p:commandLink
									styleClass="btn btn-default btn-danger btn-sm btn-block"
									style="color:#fff" value="Não"
									onclick="PF('dlg_impressao').hide();PF('statusDialog').hide();"></p:commandLink>
						</p:column>

					</p:row>

				</p:panelGrid>





			</h:form>
		</p:dialog>

		<p:dialog widgetVar="dlg_lanc_acao" modal="true" width="65%"
				  closable="true" closeOnEscape="true" showHeader="true"
				  showEffect="clip" hideEffect="clip">

			<h:form id="form_lanc_acao">
				<p:outputPanel id="lancamento_acao" style="width:100%">
					<p:messages id="msg_lancamento_acao" showDetail="true"
								showSummary="false"  closable="true" />

					<p:panelGrid columns="2" style="width:100%">
						<p:panelGrid id="recursoLinha" columns="2">

							<h:outputText value="Projetos:" />
							<p:selectOneMenu  value="#{sv_cadastro_controller.projetoAux}" style="width:180px"   filter="true" filterMatchMode="contains" converter="projetoConverter" >
								<f:selectItem noSelectionOption="true"/>
								<f:selectItems value="#{sv_cadastro_controller.listaProjeto}" var="projeto" itemLabel="#{projeto.nome}" itemValue="#{projeto}" />
								<p:ajax update="recursoLinha" onstart="start()" onerror="stop()" onsuccess="stop()" listener="#{sv_cadastro_controller.listaRubricasAndAtividades()}" />
							</p:selectOneMenu>

							<h:outputText value="Linha orçamentária:" />

							<p:selectOneMenu id="cate_compra" style="width:180px"
											 placeholder="Entre com o código/nome do projeto."
											 size="25" value="#{sv_cadastro_controller.lancamentoAcao.projetoRubrica}"
											 filter="true" filterMatchMode="contains"
											 var="categoria"
											 converter="projetoRubricaConverter">

								<f:selectItems value="#{sv_cadastro_controller.listaDeRubricasProjeto}" var="ru" itemLabel="#{ru.nomeCategoria}" itemValue="#{ru}" />


								<p:column headerText="Código">
									<h:outputText value="#{categoria.codigo}" />
								</p:column>

								<p:column headerText="Fonte">
									<h:outputText value="#{categoria.nomeFonte}" />
								</p:column>

								<p:column headerText="Projeto">
									<h:outputText value="#{categoria.nomeProjeto}" />
								</p:column>

								<p:column headerText="Componente">
									<h:outputText
											value="#{categoria.nomeComponente}" />
								</p:column>

								<p:column headerText="SubComponente">
									<h:outputText
											value="#{categoria.nomeSubComponente}" />
								</p:column>

								<p:column headerText="Linha orçamentária">
									<h:outputText
											value="#{categoria.nomeCategoria}" />
								</p:column>

								<p:column headerText="Saldo">
									<h:outputText value="#{categoria.valorSaldo}" >
										<f:convertNumber currencySymbol="R$:" minFractionDigits="2" maxFractionDigits="2" locale="pt_BR" />
									</h:outputText>
								</p:column>


							</p:selectOneMenu>

							<h:outputText value="Atividades:  "  rendered="false"/>

							<p:selectOneMenu id="listaAtividades" style="width:180px" rendered="false"
											 size="25" converter="atividadeProjetoConverter"
											 value="#{sv_cadastro_controller.lancamentoAcao.atividade}"
											 filter="true" filterMatchMode="contains" var="atividade">

								<f:selectItems
										value="#{sv_cadastro_controller.listaAtividades}" var="at"
										itemLabel="#{at.nome}" itemValue="#{at}" />


								<p:column headerText="Nome">
									<p:outputLabel value="#{atividade.nome}" />
								</p:column>

								<p:column headerText="Total">
									<p:outputLabel value="#{atividade.valor}">
										<f:convertNumber currencySymbol="R$:"
														 minFractionDigits="2" maxFractionDigits="2"
														 locale="pt_BR" />
									</p:outputLabel>
								</p:column>

								<p:column headerText="Saldo">
									<p:outputLabel value="#{atividade.saldo}">
										<f:convertNumber currencySymbol="R$:"
														 minFractionDigits="2" maxFractionDigits="2"
														 locale="pt_BR" />
									</p:outputLabel>
								</p:column>



							</p:selectOneMenu>



							<h:outputText value="Valor:" />
							<p:inputText onkeypress="return formatarNumero(this,event,19,2);"
										 placeholder="valor"
										 value="#{sv_cadastro_controller.lancamentoAcao.valor}">
								<f:convertNumber minFractionDigits="2" maxFractionDigits="2"
												 locale="pt_BR" />

							</p:inputText>


							<h:outputText value="::" />
							<p:commandLink styleClass="btn btn-primary btn-sm" onclick="start()" onerror="stop()" oncomplete="stop()"
										   process=":form_lanc_acao" update=":form_lanc_acao"
										   action="#{sv_cadastro_controller.adicionarNovaAcao()}"
										   style="color:#fff; margin: 2px 2px;" value="Adicionar" />


						</p:panelGrid>


						<p:panelGrid columns="2">

							<h:outputText value="Total da diária:" />
							<p:outputLabel value="#{sv_cadastro_controller.totalDeDiarias}">
								<f:convertNumber locale="pt_BR" type="currency" />
							</p:outputLabel>
						</p:panelGrid>

					</p:panelGrid>

				</p:outputPanel>


				<p:dataTable id="tab_lanc_acao" var="lac_acao" paginator="true"
							 rows="2" rowIndexVar="indexRow"
							 value="#{sv_cadastro_controller.diaria.lancamentosAcoes}">

					<p:column headerText="Código">
						<h:outputText value="#{lac_acao.projetoRubrica.projeto.codigo}" />
					</p:column>

					<p:column headerText="Projeto">
						<h:outputText value="#{lac_acao.projetoRubrica.projeto.nome}" />
					</p:column>

					<p:column headerText="Doação">
						<h:outputText
								value="#{lac_acao.projetoRubrica.rubricaOrcamento.orcamento.titulo}" />
					</p:column>

					<p:column headerText="Categoria">
						<h:outputText
								value="#{lac_acao.projetoRubrica.rubricaOrcamento.rubrica.nome}" />
					</p:column>

					<p:column headerText="Atividade">
						<h:outputText
								value="#{lac_acao.atividade.nome}" />
					</p:column>



					<p:column headerText="Valor" style="width:100px">
						<h:outputText value="#{lac_acao.valor}">
							<f:convertNumber type="currency" maxFractionDigits="2"
											 currencySymbol="R$" />
						</h:outputText>
					</p:column>

					<p:column style="width:50px;">
						<p:commandLink style="color:#FFF"
									   styleClass="btn btn-danger btn-xs glyphicon glyphicon-remove-circle"
									   action="#{sv_cadastro_controller.removerAcao(indexRow)}"
									   process="@this" update="tab_lanc_acao">
						</p:commandLink>
					</p:column>

					<p:columnGroup type="footer">
						<p:row>
							<p:column colspan="5" footerText="TOTAL DE RECURSO: "
									  style="text-align:right" />
							<p:column style="text-align:right"
									  footerText="#{sv_cadastro_controller.buscarValorTotalRecurso()}" />
							<p:column></p:column>
						</p:row>
					</p:columnGroup>

				</p:dataTable>

			</h:form>
		</p:dialog>


		<p:dialog widgetVar="dlg_trechos" modal="true" width="65%" header="Trechos"
				  closable="true" closeOnEscape="true" showHeader="true"
				  showEffect="clip" hideEffect="clip">
			<h:form id="cadastro_trecho">
				<p:panelGrid columns="2">

					<h:outputText value="Origem:" style="font-size:12px" />
					<p:autoComplete styleClass="font12-vi" size="45"
									panelStyle="width:180px" placeholder="Origem"
									value="#{sv_cadastro_controller.trecho.origem}"
									completeMethod="#{sv_cadastro_controller.completeLocalidade}"
									var="cidade" itemLabel="#{cidade.nome}" itemValue="#{cidade}"
									converter="localConverterVI" minQueryLength="3" />

					<h:outputText value="Destino: " style="font-size:12px" />
					<p:autoComplete styleClass="font12-vi" size="45"
									panelStyle="width:180px" placeholder="Destino"
									value="#{sv_cadastro_controller.trecho.destino}"
									completeMethod="#{sv_cadastro_controller.completeLocalidade}"
									var="cidade" itemLabel="#{cidade.nome}" itemValue="#{cidade}"
									converter="localConverterVI" minQueryLength="3" />

					<h:outputText value="Data: " style="font-size:12px" />
					<p:calendar id="datetime"
								value="#{sv_cadastro_controller.trecho.data}"
								imeZone="America/Manaus" navigator="true" pattern="dd/MM/yyyy"
								style="font-size:12px" />


					<h:outputText value="Fornecedor do transporte: "
								  style="font-size:12px" />
					<p:autoComplete id="empresa" required="true" style="font-size:12px"
									placeholder="Fornecedor"
									requiredMessage="Preencha o campo Fornecedor" size="40"
									value="#{sv_cadastro_controller.trecho.empresa}"
									completeMethod="#{sv_cadastro_controller.completeFornecedor}"
									var="fornecedor" itemLabel="#{fornecedor.nomeFantasia}"
									itemValue="#{fornecedor}" converter="fornecedorConverter"
									forceSelection="true" />

					<p:commandLink update="cadastro_trecho" style="color:#fff"
								   action="#{sv_cadastro_controller.limparTrecho()}" process="@this"
								   value="Limpar" styleClass="btn btn-block btn-danger btn-sm"></p:commandLink>

					<p:commandLink styleClass="btn btn-block btn-primary btn-sm"
								   process="cadastro_trecho" update="cadastro_trecho"
								   action="#{sv_cadastro_controller.addTrecho()}" style="color:#fff;"
								   value="Adicionar" />

				</p:panelGrid>

				<p:dataTable id="table-trechos"
							 value="#{sv_cadastro_controller.diaria.trecho}" var="trecho"
							 rowIndexVar="indexRow">
					<f:facet name="header">
						<h:outputText value="Trechos" />
					</f:facet>

					<p:column headerText="Data" style="width:90px;font-size:12px">
						<h:outputText value="#{trecho.data}" style="font-size:12px">
							<f:convertDateTime pattern="dd/MM/yyyy" timeZone="America/Manaus" />
						</h:outputText>
					</p:column>

					<p:column headerText="Empresa" style="width:30%;font-size:12px">
						<h:outputText value="#{trecho.empresa.nomeFantasia}" />
					</p:column>

					<p:column headerText="Origem" style="width:30%;font-size:12px">
						<h:outputText value="#{trecho.origem.mascara}"
									  style="font-size:12px" />
					</p:column>

					<p:column headerText="Destino:" style="width:30%;font-size:12px">
						<h:outputText value="#{trecho.destino.mascara}"
									  style="font-size:12px" />
					</p:column>


					<p:column style="width:110px">

						<p:commandLink process="@this" update="cadastro_trecho"
									   action="#{sv_cadastro_controller.prepararEdicaoTrecho(indexRow)}">
							<span style="margin-right: 3px; font-size: 12px"
								  class="fa fa-pencil"></span>editar
							<f:setPropertyActionListener value="#{trecho}"
														 target="#{sv_cadastro_controller.trecho}" />
						</p:commandLink>

					</p:column>

					<p:column style="width:110px">
						<p:commandLink
								action="#{sv_cadastro_controller.removerTrecho(indexRow)}"
								process="@this" update="table-trechos"
								onclick="PrimeFaces.monitorDownload(start, stop);">
							<span style="margin-right: 3px" class="fa fa-times"></span>excluir
						</p:commandLink>
					</p:column>

				</p:dataTable>

			</h:form>

		</p:dialog>


		<p:dialog widgetVar="dlg_escolha_page" modal="true" closable="true"
				  showHeader="false" showEffect="clip" hideEffect="clip">

			<h:form>
				<p:panelGrid>
					<p:row>
						<p:column colspan="2">
							<div align="center" style="padding: 20px">
								<h:outputText value="Finalizar processo?" />
							</div>
						</p:column>
					</p:row>

					<p:row>
						<p:column>
							<p:commandLink
									styleClass="btn btn-default btn-primary btn-sm btn-block"
									style="color:#fff" value="Sim" onclick="goBack()"></p:commandLink>
						</p:column>

						<p:column>
							<p:commandLink
									styleClass="btn btn-default btn-danger btn-sm btn-block"
									style="color:#fff" value="Não"
									onclick="PF('dlg_escolha_page').hide();PF('statusDialog').hide();"></p:commandLink>
						</p:column>

					</p:row>

				</p:panelGrid>
			</h:form>
		</p:dialog>



		<p:dialog modal="true" style="z-index:1000" widgetVar="statusDialog"
				  showHeader="false" draggable="false" closable="false"
				  resizable="false">
			<p:graphicImage library="image" name="aguarde.gif" />
			<p:graphicImage style="width:120px;height:70px" library="image"
							name="logofas.png" />
		</p:dialog>


		<p:dialog header="Mudança de Status" widgetVar="dialogAlterarStatus" modal="false" resizable="false"
				  showEffect="clip" hideEffect="clip">
			<div class="ui-fluid">
				<h:form id="formDialogAlterarStatus">

					<p:panelGrid columns="1" layout="grid">


						<p:selectOneMenu
								value="#{sv_cadastro_controller.diaria.statusCompra}"
								filter="true" filterMatchMode="contains">
							<f:selectItems value="#{sv_cadastro_controller.status}"
										   var="status" itemLabel="#{status.nome}" itemValue="#{status}" />
						</p:selectOneMenu>



					</p:panelGrid>
					<center>
						<div class="botao_central" align="left">
							<p:commandLink styleClass="btn btn-primary btn-sm" update=":form-cadastro-viagem"
										   action="#{sv_cadastro_controller.mudarStatusLancamento()}" onclick="start()"
										   onsuccess="stop()" onerror="stop()"
										   oncomplete="PF('dialogAlterarStatus').hide()"
										   style="color:#fff; margin: 8px 2px;">
								Salvar
							</p:commandLink>

							<p:commandLink styleClass="btn btn-primary btn-sm"
										   action="#{sv_cadastro_controller.carregarDiarias()}"
										   onclick="PF('dialogAlterarStatus').hide()" ajax="false"
										   process="@this"
										   style="color:#fff; margin: 8px 2px;">
								Cancelar
							</p:commandLink>

						</div>
					</center>
				</h:form>
			</div>
		</p:dialog>



	</ui:define>


</ui:composition>