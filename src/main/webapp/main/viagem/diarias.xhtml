<ui:fragment xmlns="http://www.w3.org/1999/xhtml"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
	xmlns:p="http://primefaces.org/ui"
	xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
	xmlns:jsf="http://xmlns.jcp.org/jsf">


	<h:form id="actions-diaria" class="ui-g ui-fluid">

		<div class="ui-g-12" >
			<p:commandLink styleClass="btn btn-primary btn-sm"
				onclick="setarWidthHeight('form-dialog-diaria');start()"
				onerror="stop()" style="margin-left:5px; text-align: center" title="Incluir nova linha"
				update="panel-form-nova-diaria" process="@this"
				oncomplete="PF('dlg-nova-diaria').show();stop()">
				<i class="pi pi-plus"></i>
				<span>Incluir nova diária</span>
			</p:commandLink>

			<p:commandLink style="color:#fff; margin: 2px 2px;"
				rendered="#{sv_cadastro_controller.usuarioSessao.usuario.perfil.id == 1 or sv_cadastro_controller.usuarioSessao.usuario.perfil.id == 5}"
				onclick="start()" onsuccess="stop()" onerror="stop()"
				styleClass="btn  btn-success btn-sm fa "
				action="#{sv_cadastro_controller.autorizarDiaria()}">
				<i class="pi pi-check"></i>
				<span>Autorizar Diária</span>
				<p:confirm header="Confirmação" message="Autorizar diária?"
					icon="ui-icon-alert" />
			</p:commandLink>

			<p:commandLink styleClass="btn btn-success btn-sm"
						   onclick="setarWidthHeight('form-dialog-recurso');start()"
						   onerror="stop()" style="margin-left:5px"
						   title="Recurso R$" update="panel-form-recurso"
						   process="@this" oncomplete="PF('dlg_lanc_acao').show();stop()">
				<i class="fa fa-usd" aria-hidden="true"></i>
				<span style="margin: 3px;">Recursos</span>
			</p:commandLink>

		</div>

		<div class="ui-g-12">
			<p:dataTable id="table-diaria" rowKey="#{diaria}"
				style="font-size:12px;margin-top:5px; width:100%;"
				value="#{sv_cadastro_controller.diarias}" var="diaria"
				selection="#{sv_cadastro_controller.diariasSelecionadas}">

				<p:columnGroup type="header">
					<p:row>
						<p:column rowspan="3" headerText="Selecione" />
						<p:column rowspan="3" headerText="Codigo" />
						<p:column style="width:320px" rowspan="3" headerText="colaborador" />
					</p:row>
					<p:row>
						<p:column colspan="3" headerText="Diária Integral"
							style="width:120px" />
						<p:column colspan="3" headerText="Diária Parcial" />
						<p:column rowspan="3" colspan="2" headerText="Opções" />
					</p:row>
					<p:row>

						<p:column headerText="Qtde." />
						<p:column headerText="Valor" />
						<p:column headerText="Total" />
						<p:column headerText="Qtde." />
						<p:column headerText="Valor" />
						<p:column headerText="Total" style="width:90px" />
					</p:row>

				</p:columnGroup>

				<p:column
					rendered="#{!diaria.statusCompra.nome.equals('Concluído')}"
					selectionMode="multiple" style="width:10px;text-align:center" />
				<p:column rendered="#{diaria.statusCompra.nome.equals('Concluído')}"
					style="width:10px;text-align:center">
					*
				</p:column>
				<p:column headerText="Código">
					<h:outputText style="font-size:12px" value="#{diaria.id}" />
				</p:column>

				<p:column headerText="Beneficiado">
					<h:outputText style="font-size:12px"
						value="#{diaria.contaRecebedor.nomeConta}" />
				</p:column>

				<p:column>
					<h:outputText value="#{diaria.quantidadeIntegral}">
					</h:outputText>
				</p:column>

				<p:column>
					<h:outputText value="#{diaria.valorIntegral1}">
						<f:convertNumber type="currency" maxFractionDigits="2"
							currencySymbol="R$" />
					</h:outputText>
				</p:column>

				<p:column>
					<h:outputText value="#{diaria.totalIntegral1}">
						<f:convertNumber type="currency" maxFractionDigits="2"
							currencySymbol="R$" />
					</h:outputText>
				</p:column>

				<p:column>
					<h:outputText value="#{diaria.quantidadeParcial}">
					</h:outputText>
				</p:column>

				<p:column>
					<h:outputText value="#{diaria.valorParcial1}">
						<f:convertNumber type="currency" maxFractionDigits="2"
							currencySymbol="R$" />
					</h:outputText>
				</p:column>

				<p:column style="width:90px">
					<h:outputText value="#{diaria.totalParcial1}">
						<f:convertNumber type="currency" maxFractionDigits="2"
							currencySymbol="R$" />
					</h:outputText>
				</p:column>

				<p:column colspan="2">

					<p:commandLink
						rendered="#{!diaria.statusCompra.nome.equals('Concluído') or sv_cadastro_controller.podeEditar}"
						action="#{sv_cadastro_controller.prepararEdicaoDiaria()}"
						styleClass="btn btn-default btn-xs" process="@this" update="form-dialog-diaria"
						onclick="start()"
						onerror="stop()" onsuccess="PF('dlg-nova-diaria').show();stop()">
						<span class="fa fa-pencil"></span>
						<f:setPropertyActionListener value="#{diaria}"
							target="#{sv_cadastro_controller.diaria}" />
					</p:commandLink>

					<p:commandLink title="Excluir" onclick="start()" onsuccess="stop()"
						onerror="stop()"
						rendered="#{!diaria.statusCompra.nome.equals('Concluído') or sv_cadastro_controller.podeEditar }"
						styleClass="btn btn-default btn-xs"
						style="color:#fff;margin-left:9px"
						action="#{sv_cadastro_controller.removerDiaria()}" process="@this">
						<span class="fa fa-times text-danger"></span>
						<p:confirm header="Confirmação" message="Excluir diária?"
							icon="ui-icon-alert" />
						<f:setPropertyActionListener value="#{diaria}"
							target="#{sv_cadastro_controller.diaria}" />
					</p:commandLink>


<!--				TODO: abrir pdf da DIÁRIA	-->
					<p:commandLink title="Imprimir" styleClass="btn btn-default btn-xs"
						target="_blank" ajax="false" process="@this"
						style="margin-left:9px;color:#000"
						action="#{sv_cadastro_controller.geraRelatorioDiaria()}">
						<span class="fa fa-print"></span>
						<f:setPropertyActionListener value="#{diaria}"
							target="#{sv_cadastro_controller.diaria}" />
					</p:commandLink>

<!--				TODO: mudar status da diária e atualizar a tabela automaticamente	-->
					<p:commandLink title="Mudar Status" style="margin-left:9px;"
						rendered="#{sv_cadastro_controller.usuarioSessao.usuario.perfil.descricao == 'admin'}"
						oncomplete="PF('dialogAlterarStatus').show()">
						<span class="fa fa-cog"></span>
						<f:setPropertyActionListener value="#{diaria}"
							target="#{sv_cadastro_controller.diaria}" />
					</p:commandLink>
				</p:column>

				<p:columnGroup type="footer">

					<p:row>
						<p:column />
						<p:column />
						<p:column />
						<p:column colspan="2" style="text-align:right"
							footerText="Total integral:" />
						<p:column
							footerText="#{sv_cadastro_controller.totalDiariaIntegral()}" />
						<p:column colspan="2" style="text-align:right"
							footerText="Total parcial:" />
						<p:column
							footerText="#{sv_cadastro_controller.totalDiariaParcial()}" />
						<p:column footerText="Opções" colspan="2" />

					</p:row>
				</p:columnGroup>



			</p:dataTable>
		</div>

	</h:form>

	<style type="text/css">
.fonte_sv {
	font-size: 12px;
}
</style>
</ui:fragment>